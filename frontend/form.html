<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CRM Form</title>
<link
href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
rel="stylesheet"
/>
<link
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
rel="stylesheet"
/>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<style>
#paymentStatusRefund,
#refundedAmountContainer,
#escalation,
#shipping_own_cust,
#divTrackingEdit {
display: none;
}

#yardSuggestionsList {
position: absolute;
z-index: 1000;
background-color: white;
width: 100%;
border: 1px solid #ddd;
max-height: 200px;
overflow-y: auto;
}
.modalPopup{
display: block;
background-color: white;
height: 92px;
width: 16%;
text-align: center;
border: 1px solid grey;
border-radius: 10px;
margin: 18% 47%;
}

#yardSuggestionsList .list-group-item {
cursor: pointer;
}

body {
background-color: #f8f9fa;
display: flex;
overflow-x: hidden;
flex-direction: column;
font-family: Arial, sans-serif;
}

#submitBtn{
background-color: #007bff;
}
/* #notesContainer {
margin: 4% 22% 1% 22%;
display: block;
border: 1px solid #c0c0c0;
height: 58vh;
width: 100%;

} */

.nav-item .dropdown-menu {
position: absolute;
top: 100%;
left: 0;
z-index: 9999;
display: none;
}
.descBar{
border: 2px solid black;
width: 84%;
height: auto;
margin: 2% 8%;
background-color: #c0c0c0;
text-align: center;
padding: 10px;
}
#cardCharged , #refundCollect{
display: none; /* Initially hidden */
position: fixed; /* Fixed position relative to the viewport */
top: 50%; /* Center vertically */
left: 50%; /* Center horizontally */
transform: translate(-50%, -50%); 
background-color: white; 
padding: 20px; 
border-radius: 8px; 
box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
z-index: 1000; 
width: 300px;
}

#cardCharged label, 
#cardCharged select {
display: block;
width: 100%;
margin-bottom: 10px;
}


#editYardPopup {
display: block;
background-color: white;
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
/* height: auto; */
max-height: 80vh;
overflow-y: scroll;
width: 60%;
border: 1px solid #ccc;
border-radius: 8px;
padding: 20px;
box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
z-index: 1050;
}
#editYardDetailsModal{
background-color: white;
margin: 6% 24%;
padding-right: 17px;
/* display: block; */
width: 53%;
height: 79vh;
}
.modal-body {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
}

.comments {
width: 100%;
margin-top: 20px;
}
.comments h2 {
text-align: center;
margin: -1% 10% 3% 3%;
}

/* /update comments css for responsiveness */
#submitComments {
  color: white;
  border: none;
  background-color: grey;
  border-radius: 20px;
  height: 3vh;
  width: 30%;
  text-align: center;
  cursor: pointer;
  margin: 0 auto;
  display: block; 
}

/* Responsive adjustments for smaller screens */
@media screen and (max-width: 1024px) {
  #submitComments {
    width: 40%; 
  }
}

@media screen and (max-width: 768px) {
  #submitComments {
    width: 50%; 
  }
}

@media screen and (max-width: 480px) {
  #submitComments {
    width: 60%; 
    height: 5vh;
  }
}


.btn {
display: flex;
justify-content: center;
align-items: center;
margin-top: 10px;
}
#comment-boxSupport {
height: 600px;
width: 100%;
border: 1px solid rgb(168, 164, 164);
overflow-y: scroll;
}

#comment-box {
border-radius: 4px;
overflow-y: scroll;
padding: 10px;
background: #f8f9fa;
border: 1px solid #c0c0c0;
margin: -2% 24% 1% 0%;
display: block;
border: 1px solid #c0c0c0;
height: 58vh;
width: 100%;

}

#comment-box li {
background: #f8f9fa;
border: 1px solid #ddd;
margin-bottom: 5px;
padding: 10px;
border-radius: 4px;
}

#submit {
background-color: #007bff;
border-color: #007bff;
color: white;
padding: 5px 10px;
border-radius: 5px;
cursor: pointer;
}
#submit:hover {
background-color: #0056b3;
border-color: #004085;
}

#saleNote {
border: 1px solid rgb(168, 164, 164);
margin-bottom: 1%;
padding: 10px 20px 10px 20px;
}
#saleNote p {
text-align: center;
}
textarea {
width: 530%;
height: 60px;
border: 1px solid #ccc;
border-radius: 4px;
padding: 10px;
margin: -10% 0% 2% -215%;
border: 1px solid #c0c0c0;
}
textarea#notes {
height: 150px;
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
padding: 10px 0;
}
.modal-header button {
background: none;
border: none;
font-size: 24px;
cursor: pointer;
}

#editPopInfo {
margin: 0% 31% 0% 18%;
display: flex;
align-items: center;
}

.input-group-text {
font-weight: bold;
}

.shipping-input,
.status-input,
.payment-input,
.tracking-input {
margin-top: 10px;
}

.yard-details {
display: none;
width: 100%; /* Yard details take full width available */
margin-top: 10px; /* Add some space between button and details */
}

.yard-btn {
height: 40px; /* Set a fixed height for the buttons */
width: 120px; /* Set a fixed width for the buttons */
margin: 5px; /* Add margin between buttons */
white-space: nowrap; /* Prevent text wrapping inside the buttons */
overflow: hidden; /* Hide any overflow text */
text-overflow: ellipsis; /* Show ellipsis for overflow text */
display: inline-block; /* Ensure buttons are displayed inline */
vertical-align: middle; /* Align buttons vertically to the middle */
}

.sidebarOrder,
.main-content,
.new-div {
width: calc(33.3333% - 20px);
padding: 20px;
background-color: #f8f9fa;
border-left: 1px solid #ddd;
overflow-y: auto;
margin-top: 75px;
flex: 1;
box-sizing: border-box;
/* height: 100vh; */
}

/* .new-div {
height: 100vh;
width: 33%;
padding: 20px;
background-color: #f8f9fa;
border-left: 1px solid #ddd;
overflow-y: auto;
margin-top: 75px;
flex: 1;
box-sizing: border-box;
display: block; /* Ensure it's displayed */
/* } */

#commentInput {
width: 100%;
height: 60px;
border: 1px solid #ccc;
border-radius: 4px;
padding: 10px;
}

.centered-form {
margin: 2% 50% 0% 11%;
width: 40%;
}

.container {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
margin-top: 20px;
}

body {
background-color: #f8f9fa;
display: flex;
overflow-x: hidden;
flex-direction: column;
}

.form-container {
max-width: 100%;
margin: auto;
background: white;
padding: 20px;
border-radius: 8px;
box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.1);
}

.form-group {
margin: 10px 0;
}

.form-control {
height: calc(2.25rem + 2px);
padding: 0.375rem 0.75rem;
font-size: 1rem;
line-height: 1.5;
border-radius: 0.25rem;
width: 100%;
}

.btn-primary {
background-color: grey;
border: none;
}

.btn-primary:hover {
background-color: #0056b3;
border-color: #004085;
}

.timeline {
position: relative;
padding: 21px 0;
list-style: none;
text-align: left;
}

.timeline::before {
content: "";
position: absolute;
top: 0;
bottom: 0;
width: 4px;
background: transparent;
border-left: 2px dotted grey;
left: 20px;
margin: 34px 12px -1px;
}

.timeline-item {
margin-bottom: 20px;
position: relative;
}

.timeline-item::before,
.timeline-item::after {
content: "";
display: table;
}

.timeline-item::after {
clear: both;
}

.timeline-item::before {
content: "";
position: absolute;
top: 0;
left: 15px;
width: 14px;
height: 14px;
transform: rotate(45deg);
background: #5f9f9f;
border: 4px solid #c5c5c5;
margin: 12px;
transition: transform 0.4s ease;
}

.timeline-item:hover::before {
transform: rotate(405deg);
}

.timeline-item .timeline-panel {
position: relative;
width: calc(100% - 75px);
float: right;
padding: 0 20px;
text-align: left;
border-radius: 2px;
}

.timeline-item .timeline-panel .timeline-heading {
font-weight: normal;
margin-bottom: 10px;
color: black;
background-color: #cce0e0;
padding: 10px;
border-radius: 2px;
}

.timeline-item .timeline-panel .timeline-body {
color: black;
padding: 10px;
border-radius: 2px;
}

.timeline-item:hover .timeline-heading {
background: #f8da69;
}

.navbar {
color: white;
background-color: black;
padding: 10px 20px;
display: flex;
justify-content: space-between;
align-items: center;
width: 100%;
position: fixed;
top: 0;
z-index: 2;
border-bottom: 1px solid #e0e0e0;
height: 60px; /* Set a fixed height for the navbar */
}

.navbar.black {
background-color: black;
color: white;
}

.navbar.black a {
color: white;
}

#logoImg {
height: auto;
width: 150px;
margin: -16px 6px;
}

.navbar .user-info {
display: flex;
align-items: center;
margin-left: auto;
}

.navbar .user-info span {
margin-right: 10px;
color: black;
}

.navbar .user-icon {
color: black;
cursor: pointer;
}

.dropdown-menu {
background-color: black;
border: none;
position: absolute; /* Position dropdown menus absolutely */
top: 60px; /* Align dropdowns with the bottom of the navbar */
left: 0;
right: 0;
z-index: 9999;
display: none; /* Initially hide dropdowns */
}

.dropdown-item {
color: white;
}
.dropdown-item:hover,
.dropdown-item:focus {
background-color: #ff914d;
color: black;
}
.navbar .nav-link:hover,
.navbar .nav-link:focus {
color: #ff914d;
}
.navbar .dropdown:hover .dropdown-menu {
display: block; /* Show dropdowns on hover */
}

.sidebar {
background-color: black;
position: fixed;
z-index: 1;
top: 0;
left: 0;
overflow-x: hidden;
padding-top: 20px;
width: 250px;
/* height: 100vh; */
padding: 50px 14px;
margin: 0 -22px;
transition: transform 0.3s ease;
}

.sidebar .nav-link {
color: #ffffff;
}

.sidebar .nav-link:hover {
background-color: rgba(255, 255, 255, 0.2);
}

.form-group label {
font-weight: bold;
}

.sidebar .nav-link.active,
.sidebar .nav-link.selected {
background-color: rgba(255, 255, 255, 0.2);
cursor: default;
border: none;
}

.toggle-btn,
.close-btn {
position: fixed;
top: 75px;
z-index: 1030;
cursor: pointer;
color: #fff;
}

.toggle-btn {
left: 15px;
}

.close-btn {
left: 220px;
display: none;
}

.sidebar.hide {
transform: translateX(-100%);
}

.submenu {
display: none;
}

.nav-item > .submenu {
padding-left: 20px;
}

.nav-item .nav-link {
display: flex;
justify-content: space-between;
align-items: center;
}

.nav-item .nav-link i {
margin-right: 10px;
}

.chevron-icon {
margin-left: auto;
cursor: pointer;
}

.submenu .nav-link {
color: white;
display: block;
margin-left: 20px;
}
.submenu .nav-link:hover,
.submenu .nav-link:focus {
color: #ff914d;
} 
.profile-table {
width: 50%;
margin: 20px auto;
border: 1px solid #e0e0e0;
padding: 20px;
border-radius: 8px;
box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
}

.profile-table input {
width: 100%;
padding: 8px;
margin-bottom: 10px;
border: 1px solid #ccc;
border-radius: 4px;
}

table.table td,
table.table th {
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}

.add-yard-btn {
margin-left: 10px;
font-size: 1.5rem;
font-weight: bold;
}

@media (max-width: 768px) {
.sidebar {
width: 100%;
height: auto;
position: relative;
}

/* .sidebarOrder,
.main-content,
.new-div {
width: 100%;
height: 100vh;
margin-top: 20px;
padding: 10px;
} */

.navbar {
flex-direction: column;
align-items: flex-start;
}

.toggle-btn,
.close-btn {
left: 10px;
}
select.form-control,
input.form-control {
width: 90%;
margin: auto;
}

.sidebar.hide {
transform: translateX(-100%);
}

.sidebar.show {
transform: translateX(0);
}
}

.horizontal-sidebar {
display: flex;
flex-direction: row;
width: 100%;
overflow-x: auto;
padding: 10px;
position: static;
top: auto;
left: auto;
height: auto;
background-color: #006666;
}

.horizontal-sidebar .nav-link {
flex: 1;
text-align: center;
}
.nav-link {
display: none;
}
.blur {
filter: blur(5px);
pointer-events: none;
}

#yardButtonsContainer {
width: 100%;
}
#yardInfoContainer {
display: flex;
flex-wrap: wrap;
justify-content: center;
}
.addNewId{
margin: 0% 10% 1% 10%;
width: 88%;
}
/* save button css  */
.save {
background-color: #ff914d;
border: 1px solid black;
width: 14%;
font-weight: bold;
margin: 0% 45%;
border-radius: 12px;
box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.5);
}

/* Fix input box disabling issue */
input:disabled,
textarea:disabled,
select:disabled {
background-color: #e9ecef; /* Ensure disabled inputs are visually distinguishable */
opacity: 1; /* Fix opacity to make it look consistent */
cursor: not-allowed; /* Show a not-allowed cursor */
}
.escalationReturn,.escalationReplacement {
display: none;
display: flex;
justify-content: space-between;
gap: 80px;
margin: 2% 0%;
border: 1px solid #c0c0c0;
padding: 33px;
}

.escalationReturn .form-group {
flex: 1; /* Each item will take up equal width */
min-width: 200px; /* Ensure a minimum width for smaller screens */
}

.checkbox-group {
display: flex;
gap: 10px;
flex-direction: column; /* Ensure checkboxes are in a column within the form group */
}

.form-group label {
display: block;
margin-bottom: 5px;
}

.form-group input[type="text"], .form-group select {
width: 100%; /* Make input fields and select dropdowns take full width */
}


</style>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const firstName = localStorage.getItem("firstName");
if (!firstName) {
window.location.href = "login_signup.html";
}
</script>
</head>

<body>
<div class="navbar" id="navbar" style="display: flex">
<div class="logo">
<img id="logoImg" src="https://assets-autoparts.s3.ap-south-1.amazonaws.com/images/darkLogo.png" alt="Logo" />
</div>
<div class="navbar-nav" style="    flex-direction: row;justify-content: center;align-items: center;margin-left: 62%;font-family: sans-serif;">
<div class="nav-item dropdown">
<a
class="nav-link dropdown-toggle"
href="#"
id="navbarDropdownDashboards"
role="button"
data-toggle="dropdown"
aria-haspopup="true"
aria-expanded="false"
>
Dashboards
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownDashboards">
<a class="dropdown-item" href="addOrders.html?newEntry=true">Add New Order</a>
<a class="dropdown-item" href="placedOrders.html">Placed Orders</a>
<a class="dropdown-item" href="customerApproved.html">Customer Approved</a>
<a class="dropdown-item" href="orders.html">View Orders</a>
<a class="dropdown-item" href="viewAllOrders.html">View All Orders</a>
<!-- <a class="dropdown-item" href="individualOrders.html">View My Orders</a> --> 
<!-- <a class="dropdown-item" href="ordersMark.html">TeamA Orders</a>  -->
<!-- <a class="dropdown-item" href="ordersSussane.html">TeamB Orders</a>  -->
<a class="dropdown-item" href="cancelledOrders.html">Cancelled Orders</a>
<a class="dropdown-item" href="yardInfo.html">Yard Details</a>
<a class="dropdown-item" href="viewAllOrdersSheetMode.html">View All Orders- Sheet Mode</a>
<a class="nav-link" href="fulfilledOrders.html">Fulfilled Orders</a>
<a class="dropdown-item" href="escalatedOrders.html">Escalation</a>
</div>
</div>
<div class="nav-item dropdown">
<a
class="nav-link dropdown-toggle"
href="#"
id="navbarDropdownUsers"
role="button"
data-toggle="dropdown"
aria-haspopup="true"
aria-expanded="false"
>
Users
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownUsers">
<a class="dropdown-item" href="createUser.html">Create User</a>
<a class="dropdown-item" href="viewallUsers.html">View Users</a>
</div>
</div>
<div class="nav-item dropdown">
<a
class="nav-link dropdown-toggle"
href="#"
id="navbarDropdownTeams"
role="button"
data-toggle="dropdown"
aria-haspopup="true"
aria-expanded="false"
>
Teams
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownTeams">
<a class="dropdown-item" href="teams.html">View Teams</a>
</div>
</div>
<div class="nav-item dropdown">
<a
class="nav-link dropdown-toggle"
href="#"
id="navbarDropdownReports"
role="button"
data-toggle="dropdown"
aria-haspopup="true"
aria-expanded="false"
>
Reports
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownReports">
<a class="dropdown-item" href="shippingExpenses.html"
>Shipping Expenses</a
>
<a class="dropdown-item" href="purchases.html">Purchases</a>
<a class="dropdown-item" href="poReport.html">PO Report</a>
<a class="dropdown-item" href="salesReport.html">My Sales Report</a>
<a class="dropdown-item" href="deliveryTime.html">Delivery Report</a>
</div>
</div>
</div>
<div class="user-info dropdown">
<span>Welcome <span id="user-name">Shankar</span></span>
<i
class="fas fa-user-circle fa-2x user-icon"
id="userMenu"
data-toggle="dropdown"
aria-haspopup="true"
aria-expanded="false"
></i>
<div
class="dropdown-menu dropdown-menu-right"
aria-labelledby="userMenu"
>
<a class="dropdown-item" href="#" id="profileLink"
><i class="fas fa-user"></i> My Profile</a
>
<div class="dropdown-divider"></div>
<a class="dropdown-item" href="#" id="logoutLink"
><i class="fas fa-sign-out-alt"></i> Log Out</a
>
</div>
</div>
</div>

<div class="close-btn">
<span>&times;</span>
</div>

<div class="sidebar" id="offcanvasSidebar">
<div class="offcanvas-body">
<nav class="nav flex-column">
<div class="nav-item dashboards">
<a class="nav-link" href="#" id="default-link">
<i class="fas fa-home"></i> Dashboards
<span class="chevron-icon"><i class="fas fa-chevron-right"></i></span>
</a>
<div class="submenu" id="submenu-dashboards">
<a class="nav-link add-order-link" href="form.html?newEntry=true">Add New Order</a>
<a class="nav-link view-orders-link" href="orders.html">View Orders</a>
<a class="nav-link view-individualOrders-link" href="individualOrders.html">View My Orders</a>
<a class="nav-link teamA-orders-link" href="ordersMark.html">TeamA Orders</a>
<a class="nav-link teamB-orders-link" href="ordersSussane.html">TeamB Orders</a>
<a class="nav-link placed-orders-link" href="placedOrders.html">Placed Orders</a>
<a class="nav-link cancelled-orders-link" href="cancelledOrders.html">Cancelled Orders</a>
<a class="nav-link yard-info-link" href="yardInfo.html">Yard Details</a>
</div>
</div>
<div class="nav-item" id="users-section">
<a class="nav-link" href="#">
<i class="fas fa-users"></i> Users
<span class="chevron-icon"><i class="fas fa-chevron-right"></i></span>
</a>
<div class="submenu" id="submenu-users">
<a class="nav-link" href="createUser.html">Create User</a>
<a class="nav-link" href="viewallUsers.html">View Users</a>
</div>
</div>
<div class="nav-item" id="teams-section">
<a class="nav-link" href="#">
<i class="fas fa-users-cog"></i> Teams
<span class="chevron-icon"><i class="fas fa-chevron-right"></i></span>
</a>
<div class="submenu" id="submenu-teams">
<a class="nav-link" href="teams.html">View Teams</a>
</div>
</div>
<div class="nav-item">
<a class="nav-link" href="#">
<i class="fas fa-chart-bar"></i> Reports
<span class="chevron-icon"><i class="fas fa-chevron-right"></i></span>
</a>
<div class="submenu" id="submenu-reports">
<a class="nav-link" href="shippingExpenses.html">Shipping Expenses</a>
<a class="nav-link" href="purchases.html">Purchases</a>
<a class="nav-link" href="poReport.html">PO Report</a>
<a class="nav-link" href="salesReport.html">My Sales Report</a>
</div>
</div>
</nav>
</div>
</div>

<div style="display: flex" class="mainDiv">

<div class="sidebarOrder">
<h2 id="orderHistory">Order History - </h2>
<ul id="orderHistoryList" class="timeline"></ul>
</div>

<div class="main-content" id="mainContent">
<form id="crmForm" class="form-container">
<div class="form-row">
<div class="form-group col-md-6">
<label for="orderDate">Order Date</label>
<input type="text" class="form-control" id="orderDate" required />
</div>
<div class="form-group col-md-6">
<label for="salesAgent">Sales Agent</label>
<input
type="text"
class="form-control"
id="salesAgent"
required
/>
</div>
</div>
<div class="form-group">
<div id="custInfo" style="border: 1px solid grey">
<label
for="customerInfo"
class="d-block text-center font-weight-bold py-2"
>CUSTOMER INFO</label
>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="firstName">First Name</label>
<input
type="text"
class="form-control"
id="firstName"
required
/>
</div>
<div class="form-group col-md-6">
<label for="lastName">Last Name</label>
<input
type="text"
class="form-control"
id="lastname"
required
/>
</div>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="email">Email</label>
<input type="email" class="form-control" id="email" required />
</div>
<div class="form-group col-md-6">
<label for="phone">Phone</label>
<input type="text" class="form-control" id="phone" required />
</div>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="bAddress">Billing Address</label>
<input
type="text"
class="form-control"
id="bAddress"
required
/>
</div>
<div class="form-group col-md-6">
<label for="sAddress">Shipping Address</label>
<input
type="text"
class="form-control"
id="sAddress"
required
/>
</div>
</div>
</div>
<div class="form-group">
<div id="partDesc" style="border: 1px solid grey">
<label
for="partDescription"
class="d-block text-center font-weight-bold py-2"
>PART DESCRIPTION</label
>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="make">Make</label>
<input type="text" class="form-control" id="make" required />
</div>
<div class="form-group col-md-6">
<label for="model">Model</label>
<input type="text" class="form-control" id="model" required />
</div>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="year">Year</label>
<input type="number" class="form-control" id="year" required />
</div>
<div class="form-group col-md-6">
<label for="pReq">Part Required</label>
<select class="form-control" id="pReq" required>
<option value="ABS Pump">ABS Pump</option>
<option value="ABS Module">ABS Module</option>
<option value="Transmission">Transmission</option>
<option value="ABS Module"></option>
</select>
</div>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="desc">Description</label>
<input type="text" class="form-control" id="desc" />
</div>
<div class="form-group col-md-6">
<label for="warranty">Warranty</label>
<input type="number" class="form-control" id="warranty" />
</div>
</div>
</div>
<div class="form-group">
<div class="pricenGp" style="border: 1px solid grey">
<label
for="priceProfit"
class="d-block text-center font-weight-bold py-2"
>PRICE AND GP INFORMATION</label
>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="soldP">Quoted Price</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">$</span>
</div>
<input
type="number"
class="form-control"
id="soldP"
required
/>
</div>
</div>
<div class="form-group col-md-6">
<label for="costP">Yard Price</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">$</span>
</div>
<input
type="number"
class="form-control"
id="costP"
required
/>
</div>
</div>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="shippingFee">Est. Shipping</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">$</span>
</div>
<input
type="number"
class="form-control"
id="shippingFee"
required
/>
</div>
</div>
<div class="form-group col-md-6">
<label for="salestax">Sales Tax(%)</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">$</span>
</div>
<input
type="number"
class="form-control"
id="salestax"
readonly
required
/>
</div>
</div>
</div>
<div class="form-group">
<label for="grossProfit">Est. GP</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">$</span>
</div>
<input
type="number"
class="form-control"
id="grossProfit"
readonly
required
/>
</div>
</div>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="orderStatus">Order Status</label>
<select class="form-control" id="orderStatus" required>
<option value="Placed">Order Placed</option>
<option value="Customer approved">Customer Approved</option>
<option value="Yard Processing">Yard Processing</option>
<option value="In Transit">In Transit</option>
<option value="Escalation">Escalation</option>
<option value="Order Fulfilled">Order Fulfilled</option>
<option value="Order Cancelled">Order Cancelled</option>
<option value="Part Delivered">Part Delivered</option>
<option value="Refunded">Refunded</option>
</select>
</div>
<div class="form-group col-md-6">
<label for="vin">VIN No.</label>
<input type="text" class="form-control" id="vin" required />
</div>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="issueOrder">Last 4 Digits</label>
<input
type="text"
class="form-control"
id="issueOrder"
required
/>
</div>
<div class="form-group col-md-6" style="display: flex;margin-top: 56px;">
<label for="escCheckBox">Escalation</label>
<input
type="checkbox"
class="form-control"
id="escTickBox"
style="margin-right: 94px;margin-top: -9px;"
/>
</div>
</div>
<div id="yardButtonsContainer" class="d-flex flex-column align-items-center">
<div id="yardInfoContainer" class="d-flex flex-row mb-3"></div>
<button type="button" class="btn add-yard-btn">+</button>
</div>          
<div id="trackingInfoContainer"></div>
<button
type="submit"
class="btn btn-block"
id="submitBtn"
>
Submit
</button>
</form>
</div>



<div class="new-div">
<div id="saleNote">
<h2 style="padding-left: 10px;text-align: center;font-weight: 600;">
Sale Note
</h2>
</div>
<h2 style="padding-left: 10px;text-align: center;font-weight: 600;">
Comments
</h2>
<div
id="comment-boxSupport"
style="padding: 10px 20px 20px 10px"
></div>
<div class="commentsInput" id="commentsContainer"></div>
<div class="containers">
<form>
<input
id="commentInput"
placeholder="Type Your Comments here..."
></input>
<div class="btn">
<input
id="submitComments"
type="submitComments"
value="Update Comments"
/>
</div>
</form>
</div>
</div>
</div>

<!-- add yard starts here -->
<div class="modal fade" id="yardModal" tabindex="-1" aria-labelledby="yardModalLabel" aria-hidden="true" style="display: none;">
<div class="modal-dialog">
<div class="modal-content" style="margin: 19% -43%;width: 202%;height: 80vh;padding: 10px 28px;">
<div class="modal-header">
<h5 class="modal-title" id="yardModalLabel" style="margin: 0% 33%;font-weight: bold; white-space: nowrap;overflow: hidden;">Add New Yard - </h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="partDescFY descBar"></div>
<div class="modal-body" style="margin: -2% 0%;">
<div class="form-row addNewId">
<div class="form-group col-md-4">
<input type="text" class="form-control" id="yardName" placeholder="Yard Name" required autocomplete="off">
<ul id="yardSuggestionsList" class="list-group" style="display: none; position: absolute; z-index: 1000;"></ul>
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="agentName" placeholder="Agent Name" required>
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="yardRating" placeholder="Yard Rating Info" required>
</div>
</div>
<div class="form-row addNewId">
<div class="form-group col-md-4">
<input type="text" class="form-control" id="phoneYard" placeholder="Phone Number" required>
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="altPhone" placeholder="Alt. Phone Number" />
</div>
<div class="form-group col-md-4">
<input type="number" class="form-control" id="ext" placeholder="Extension">
</div>
</div>
<div class="form-row addNewId">
  <div class="form-group col-md-4">
    <input type="email" class="form-control" id="email" placeholder="Email Id">
    </div>
  <div class="form-group col-md-4">
  <input type="number" class="form-control" id="faxNo" placeholder="Enter Fax No." >
  </div>
  </div>
<div class="form-row" style="margin: 4% 10% 1% 10%;width: 88%;">
<div class="form-group col-md-4">
<input type="text" class="form-control" id="address" placeholder="Street Address" required>
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="city" placeholder="Enter City" required>
</div>
<!-- <div class="form-group col-md-4">
<input type="text" class="form-control" id="state" placeholder="Enter State" required>
</div> -->
<div class="form-group col-md-4">
  <select class="form-control" id="state" required>
    <option value="">Select State/Province</option>
    <!-- United States States -->
    <option value="AL">Alabama</option>
    <option value="AK">Alaska</option>
    <option value="AZ">Arizona</option>
    <option value="AR">Arkansas</option>
    <option value="CA">California</option>
    <option value="CO">Colorado</option>
    <option value="CT">Connecticut</option>
    <option value="DE">Delaware</option>
    <option value="FL">Florida</option>
    <option value="GA">Georgia</option>
    <option value="HI">Hawaii</option>
    <option value="ID">Idaho</option>
    <option value="IL">Illinois</option>
    <option value="IN">Indiana</option>
    <option value="IA">Iowa</option>
    <option value="KS">Kansas</option>
    <option value="KY">Kentucky</option>
    <option value="LA">Louisiana</option>
    <option value="ME">Maine</option>
    <option value="MD">Maryland</option>
    <option value="MA">Massachusetts</option>
    <option value="MI">Michigan</option>
    <option value="MN">Minnesota</option>
    <option value="MS">Mississippi</option>
    <option value="MO">Missouri</option>
    <option value="MT">Montana</option>
    <option value="NE">Nebraska</option>
    <option value="NV">Nevada</option>
    <option value="NH">New Hampshire</option>
    <option value="NJ">New Jersey</option>
    <option value="NM">New Mexico</option>
    <option value="NY">New York</option>
    <option value="NC">North Carolina</option>
    <option value="ND">North Dakota</option>
    <option value="OH">Ohio</option>
    <option value="OK">Oklahoma</option>
    <option value="OR">Oregon</option>
    <option value="PA">Pennsylvania</option>
    <option value="RI">Rhode Island</option>
    <option value="SC">South Carolina</option>
    <option value="SD">South Dakota</option>
    <option value="TN">Tennessee</option>
    <option value="TX">Texas</option>
    <option value="UT">Utah</option>
    <option value="VT">Vermont</option>
    <option value="VA">Virginia</option>
    <option value="WA">Washington</option>
    <option value="WV">West Virginia</option>
    <option value="WI">Wisconsin</option>
    <option value="WY">Wyoming</option>
    
    <!-- Canadian Provinces -->
    <option value="AB">Alberta</option>
    <option value="BC">British Columbia</option>
    <option value="MB">Manitoba</option>
    <option value="NB">New Brunswick</option>
    <option value="NL">Newfoundland and Labrador</option>
    <option value="NS">Nova Scotia</option>
    <option value="ON">Ontario</option>
    <option value="PE">Prince Edward Island</option>
    <option value="QC">Quebec</option>
    <option value="SK">Saskatchewan</option>
    <option value="NT">Northwest Territories</option>
    <option value="NU">Nunavut</option>
    <option value="YT">Yukon</option>
  </select>
</div>
</div>
<div class="form-row addNewId">
<div class="form-group col-md-4">
<select class="form-control" id="country">
<option selected>Select Country</option>
<option value="US">US</option>
<option value="Canada">Canada</option>
</select>
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="zip" placeholder="Enter Zipcode" required>
</div>
</div>
<div class="form-row addNewId">
<div class="form-group col-md-4">
<label for="partPrice" style="font-size: 12px;color: #6e6b6b;" id="estPP">Est. Part Price : </label>
<input type="number" class="form-control" id="partPrice" placeholder="Part Price" required>
</div>
<div class="form-group col-md-4">
<label for="ownS"></label>
<input type="number" class="form-control" id="ownShipping" placeholder="Own Shipping" style="margin-top:8%;" />
</div>
<div class="form-group col-md-4">
<label for="yardS"></label>
<input type="number" class="form-control" id="yardShipping" placeholder="Yard Shipping" style="margin-top:8%;"/>
</div>
</div>
<div class="form-row addNewId">
<div class="form-group col-md-4">
<input type="number" class="form-control" id="others" placeholder="Other Charges" />
</div>
<div class="form-group col-md-4">
<label for="ownS"></label>
<input type="text" class="form-control" id="stockNo" placeholder="Stock No." style="margin-top:-2%;" />
</div>
<div class="form-group col-md-4">
<label for="yardS"></label>
<input type="number" class="form-control" id="warr" placeholder="Warranty" style="margin-top:-2%;"/>
</div>
</div>

</div>
<button type="button" class="btn save" id="addYardInfo">Submit</button>
</div>
</div>
</div>    
<!-- add yard ends here -->

<div id="editYardPopup" style="display: none">
<div >
<button
type="button"
class="close"
data-dismiss="modal"
aria-label="Close"
>
<span id="crossBtnEditYard" aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<div class="form-group" id="editPopInfo">
<label for="refund"  style="font-size: 25px;
margin: 4%;">Status:</label>
<select id="refund" style="    width: 66%;
border-radius: 25px;
margin: 5% -12% 6% 0%;
background-color: black;
color: white;
padding: 15px 8px 15px 8px;
text-align: center;">
<!-- <option value="">Choose</option> -->
<option value="Yard located">Yard Located</option>
<option value="Yard PO Sent">PO Sent</option>
<option value="PO confirmed">PO Confirmed</option>
<option value="PO cancelled">PO Cancelled</option>
<option value="Part shipped">Part Shipped</option>
<option value="Part delivered">Part Delivered</option>
<option value="Escalation">Escalation</option>
</select>
<!-- <div id="cardCharged">
<label for="paymentStatusCard">Card Charged:</label>
<select class="form-control paymentStatus">
<option value="">Choose</option>
<option value="Card charged">Charged</option>
<option value="">Not charged</option>
</select>
</div> -->
<!-- <label for="paymentStatusRefund" style="display: none"
>Refund Collected:</label
>
<select
class="form-control paymentStatus"
id="paymentStatusSelect"
style="display: none"
>
<option value="">Choose</option>
<option value="Refund collected">Yes</option>
<option value="">No</option>
</select>
<div id="refundedAmountContainer">
<label for="refundedAmount">Refunded Amount:</label>
<input
type="number"
class="form-control"
id="refundedAmount"
placeholder="Enter refunded amount"
/>
</div> -->
<div>
<button
type="button"
class="btn save"
id="editYardInfo"
style="border-radius: 22px;align-items: center;margin: 6% 2% 8% 72%;width: 170%;height: 5vh;">
Save
</button>
</div>
</div>

<div id="escalation" style="display: flex;">
<div>
<label for="reason1">Reason:</label>
<select
name="esc"
id="esc"
style="padding: 0.6%; width: 59%; border: 1px solid #d9d4d4"
>
<option value="">Choose</option>
<option value="Damaged">Damaged</option>
<option value="Defective">Defective</option>
<option value="Incorrect">Incorrect</option>
<option value="Not programming">Not programming</option>
</select>
</div>
<div id="escRMA" style="display: flex;">
<label for="reason" style="white-space: nowrap;">Escalation Process:</label>
<select
name="esc"
id="escProcess"
style="width: 51.8%;
border: 1px solid #d9d4d4;
height: 4vh;
">
<option value="">Choose</option>
<option value="RMA Sent">Under Progress</option>
<option value="Replacement">Replacement</option>
<!-- <option value="Return tracking sent">Return Tracking Sent</option> -->
<option value="Return">Return</option>
</select>
</div>
</div>
<div id="shipping_own_cust">
<div class="form-group">
<div class="form-row">
<div class="col-md-6">
<label class="radio-inline">
<input type="radio" name="returnValue" value="Our shipping" />
Our Shipping
</label>
<input
type="number"
class="returnShipment"
id="ourShippingInput"
placeholder="Our Shipping Price"
/>
</div>
<div class="col-md-6">
<label class="radio-inline">
<input
type="radio"
value="Customer shipping"
name="returnValue"
/>
Customer Shipping
</label>
<input
type="number"
class="returnShipment"
value="0"
id="customerShippingInput"
placeholder="Customer Shipping Price"
/>
</div>
</div>
</div>
</div>
<!--escalation return div -->

<div class="escalationReturn" style="display: none;">
<div id="rma-status-group">
<label for="rma-status">RMA Status:</label>
<div class="checkbox-group">
<div>
<input value="RMA Sent" type="checkbox" id="rma-sent" name="rma-status">
<label for="rma-sent">RMA Sent</label>
</div>
<div>
<input value="Junked" type="checkbox" id="junked" name="rma-status">
<label for="junked">Junked</label>
</div>
</div>
</div>   

<div>
<label for="shipping-type">Shipping Type:</label>
<select id="customer" name="customer" class="form-control">
<option value="Customer shipping">Customer</option>
<option value="Return- Yard shipping">Yard Shipping</option>
<option value="Return- Own shipping">Own Shipping</option>
</select>
</div>

<div id="shipping-charges-container" style="display: none;">
<label for="shipping-charges">Shipping Charges</label>
<input type="number" id="shipping-charges" name="shipping-charges" class="form-control" placeholder="Enter Shipping Charges">
</div>
</div>

<!-- escalation replacement div -->
<div class="escalationReplacement" style="display: none;">
<div>
<label for="shipping-type">Shipping Type:</label>
<select id="replacement-customer" name="customer" class="form-control">
<option value="Customer shipping">Customer</option>
<option value="Replacement- Yard shipping">Yard Shipping</option>
<option value="Replacement- Own shipping">Own Shipping</option>
</select>
</div>

<div id="replacement-shipping-charges-container" style="display: none;">
<label for="shipping-charges">Shipping Charges</label>
<input type="number" id="replacement-shipping-charges" name="shipping-charges" class="form-control" placeholder="Enter Shipping Charges">
</div>
</div>
<!-- escalation replacement div ends here -->

<div class="inputForCust"></div>
<div class="form-group" id="divTrackingEdit">
<label>Tracking Information:</label>
<table class="table table-bordered" id="trackingTableEdit">
<thead>
<tr>
<th>Tracking No</th>
<th>ETA</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<input
type="text"
class="form-control"
id="trackingNoEdit"
placeholder="Enter Tracking No"
required
/>
</td>
<td>
<input
type="number"
class="form-control"
id="etaEdit"
placeholder="Enter ETA"
required
/>
</td>
</tr>
<tr>
<td colspan="2">
<select class="form-control" id="shipperNameEdit" required>
<option value="" disabled selected>Select Shipper</option>
<option value="UPS">UPS</option>
<option value="World Wide Express">World Wide Express</option>
<option value="FedEx">FedEx</option>
<option value="Others">Others</option> <!-- Others option -->
</select>

<!-- This input will only be shown if 'Others' is selected -->
<input type="text" class="form-control mt-2" id="otherShipperInput" placeholder="Please specify other shipper" style="display:none;">
</td>

</tr>
<tr>
<td colspan="2">
<input
type="url"
class="form-control"
id="linkInput"
placeholder="Enter Link"
required
/>
</td>
</tr>
</tbody>
</table>
<button type="button" class="btn btn-primary" id="sendEmailButton">
Send Email
</button>
</div>
<div class="comments" id="notesContainer">
<h2>Yard Notes</h2>
<div id="comment-box"></div>
</div>
<div class="container">
<form>
<textarea
id="noteInput"
placeholder="Type Your Notes here..."
></textarea>
<div class="btn">
<input
id="submit"
type="submit"
value="Update Notes"
style="
margin: -60% 0% 7% 522%;
border-radius: 20px;
background-color: grey;
border: none;
"
/>
</div>
</form>
</div>
</div>
<input type="hidden" id="yardIndexEdit" />
</div>

<!-- edit yard details -->
<div class="modal fade" id="editYardDetailsModal" tabindex="-1" aria-labelledby="editYardDetailsModalLabel" aria-hidden="true" style="display: none;">
<!-- <div class="modal-dialog"> -->
<!-- <div class="modal-content" > -->

<div class="modal-header">
<h5 class="modal-title" id="editYardDetailsModalLabel" style="margin: 0% 26%;
font-weight: bold;
overflow: hidden;
white-space: nowrap;">Edit Yard Details- </h5>
<button type="button" id="EYdetails" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="partDescFY descBar"></div>
<div class="modal-body">
<div class="form-row addNewId">
<div class="form-group col-md-4">
<input type="text" class="form-control" id="editYardName" placeholder="Yard Name" />
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="editAgentName" placeholder="Agent Name" />
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="editYardRating" placeholder="Yard Rating Info" />
</div>
</div>
<div class="form-row addNewId">
<div class="form-group col-md-4">
<input type="text" class="form-control" id="editPhone" placeholder="Phone Number" />
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="editAltPhone" placeholder="Alt. Phone Number" />
</div>
<div class="form-group col-md-4">
<input type="number" class="form-control" id="editExt" placeholder="Extension" />
</div>
</div>
<div class="form-row addNewId">
  <div class="form-group col-md-4">
    <input type="email" class="form-control" id="editEmail" placeholder="Email Id" />
    </div>
    <div class="form-group col-md-4">
      <input type="number" class="form-control" id="editFax" placeholder="Fax No" />
      </div>
    </div>
<div class="form-row" style="margin: 4% 10% 1% 10%;width: 88%;">
<div class="form-group col-md-4">
<input type="text" class="form-control" id="editAddress" placeholder="Street Address" />
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="editCity" placeholder="Enter City" />
</div>
<div class="form-group col-md-4">
  <select class="form-control" id="state" required>
    <option value="">Select State/Province</option>
    <!-- United States States -->
    <option value="AL">Alabama</option>
    <option value="AK">Alaska</option>
    <option value="AZ">Arizona</option>
    <option value="AR">Arkansas</option>
    <option value="CA">California</option>
    <option value="CO">Colorado</option>
    <option value="CT">Connecticut</option>
    <option value="DE">Delaware</option>
    <option value="FL">Florida</option>
    <option value="GA">Georgia</option>
    <option value="HI">Hawaii</option>
    <option value="ID">Idaho</option>
    <option value="IL">Illinois</option>
    <option value="IN">Indiana</option>
    <option value="IA">Iowa</option>
    <option value="KS">Kansas</option>
    <option value="KY">Kentucky</option>
    <option value="LA">Louisiana</option>
    <option value="ME">Maine</option>
    <option value="MD">Maryland</option>
    <option value="MA">Massachusetts</option>
    <option value="MI">Michigan</option>
    <option value="MN">Minnesota</option>
    <option value="MS">Mississippi</option>
    <option value="MO">Missouri</option>
    <option value="MT">Montana</option>
    <option value="NE">Nebraska</option>
    <option value="NV">Nevada</option>
    <option value="NH">New Hampshire</option>
    <option value="NJ">New Jersey</option>
    <option value="NM">New Mexico</option>
    <option value="NY">New York</option>
    <option value="NC">North Carolina</option>
    <option value="ND">North Dakota</option>
    <option value="OH">Ohio</option>
    <option value="OK">Oklahoma</option>
    <option value="OR">Oregon</option>
    <option value="PA">Pennsylvania</option>
    <option value="RI">Rhode Island</option>
    <option value="SC">South Carolina</option>
    <option value="SD">South Dakota</option>
    <option value="TN">Tennessee</option>
    <option value="TX">Texas</option>
    <option value="UT">Utah</option>
    <option value="VT">Vermont</option>
    <option value="VA">Virginia</option>
    <option value="WA">Washington</option>
    <option value="WV">West Virginia</option>
    <option value="WI">Wisconsin</option>
    <option value="WY">Wyoming</option>
    
    <!-- Canadian Provinces -->
    <option value="AB">Alberta</option>
    <option value="BC">British Columbia</option>
    <option value="MB">Manitoba</option>
    <option value="NB">New Brunswick</option>
    <option value="NL">Newfoundland and Labrador</option>
    <option value="NS">Nova Scotia</option>
    <option value="ON">Ontario</option>
    <option value="PE">Prince Edward Island</option>
    <option value="QC">Quebec</option>
    <option value="SK">Saskatchewan</option>
    <option value="NT">Northwest Territories</option>
    <option value="NU">Nunavut</option>
    <option value="YT">Yukon</option>
  </select>
</div>

<!-- <div class="form-group col-md-4">
<input type="text" class="form-control" id="editState" placeholder="Enter State" />
</div> -->
</div>
<div class="form-row addNewId">
<div class="form-group col-md-4">
<select class="form-control" id="editCountry">
<option selected>Select Country</option>
<option value="US">US</option>
<option value="Canada">Canada</option>
</select>
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="editZip" placeholder="Enter Zipcode" />
</div>
</div>
<div class="form-row addNewId">
<div class="form-group col-md-4">
<input type="number" class="form-control" id="editPartPrice" placeholder="Part Price" />
</div>
<div class="form-group col-md-4">
<input type="number" class="form-control" id="editOwnShipping" placeholder="Own Shipping" />
</div>
<div class="form-group col-md-4">
<input type="number" class="form-control" id="editYardShipping" placeholder="Yard Shipping" />
</div>
</div>
<!-- last row with others, paymentStatus and refundStatus -->
<div class="form-row addNewId">
<div class="form-group col-md-4">
<input type="number" class="form-control" id="editOthers" placeholder="Other Charges" />
</div>
<div class="form-group col-md-4">
<input type="text" class="form-control" id="editPaymentStatus" placeholder="Payment Status" readonly />
</div>
<div class="form-group col-md-4">
<input type="number" class="form-control" id="editrefundAmount" placeholder="Refund Amount" />
</div>
</div>
<div class="form-row addNewId">
<div class="form-group col-md-4">
<input type="number" class="form-control" id="editWarr" placeholder="Warranty" />
</div>
</div>

<!-- <div class="form-row">
<div class="form-group " style="margin: 0% -56%;width: 60%;">
<input type="number" class="form-control" id="editOthers" placeholder="Other Charges" style="     margin: 0% 0% 0% -140%;
width: 203%;" />
</div> -->
<!-- <div class="form">
<label class="form-control" id="totalSpending" style="border: none;text-align: center;margin: 17% 148%;">Total Yard Spending: $100.25</label>
</div> -->
</div>
<div >
<!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
<button type="button" class="btn save" id="saveYardDetails">Save</button>
</div>
</div>

<!-- </div> -->
<!-- </div> -->
</div>
<!-- edit yard details ends here -->

<!-- card charged div starts here -->
<div id="cardCharged">
<button id="closeCardCharged" style="float: right; background: none; border: none; font-size: 20px;">&times;</button>
<label for="paymentStatusCard">Card Charged:</label>
<select class="form-control paymentStatus">
<option value="">Choose</option>
<option value="Card charged">Charged</option>
<option value="">Not charged</option>
</select>
<button id="cardChargedSbmit">Submit</button>
</div>
<!-- card charged div ends here -->
<!-- refund  div starts here -->
<div id="refundCollect">
<button id="closeRefundCollected" style"float: right; background: none; border: none; font-size: 20px;">&times;</button>
<label for="paymentStatusRefund">Refund Collected:</label
>
<select
class="form-control paymentStatusRefund"
id="paymentStatusSelect">
<option value="">Choose</option>
<option value="Refund collected">Yes</option>
<option value="">No</option>
</select>
<div id="refundedAmountContainer">
<label for="refundedAmount">Refunded Amount:</label>
<input
type="number"
class="form-control"
id="refundedAmount"
placeholder="Enter refunded amount"
/>
<button id="refundSubmit">Submit</button>
</div>
</div>        
<!-- refund div ends here -->


<div
class="modal fade"
id="profileModal"
tabindex="-1"
role="dialog"
aria-labelledby="profileModalLabel"
aria-hidden="true"
>
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="profileModalLabel">My Profile</h5>
<button
type="button"
class="close"
data-dismiss="modal"
aria-label="Close"
>
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<form id="profileForm">
<div class="form-group">
<label for="profileFirstName">First Name</label>
<input
type="text"
class="form-control"
id="profileFirstName"
readonly
/>
</div>
<div class="form-group">
<label for="profileLastName">Last Name</label>
<input
type="text"
class="form-control"
id="profileLastName"
readonly
/>
</div>
<div class="form-group">
<label for="profileEmail">Email</label>
<input
type="email"
class="form-control"
id="profileEmail"
readonly
/>
</div>
<div class="form-group">
<label for="profileRole">Role</label>
<input
type="text"
class="form-control"
id="profileRole"
readonly
/>
</div>
</form>
</div>
<div class="modal-footer">
<button
type="button"
class="btn btn-secondary close"
data-dismiss="modal"
>
Close
</button>
</div>
</div>
</div>
</div>


<!-- Approve Modal popup -->
<div
class="modal fade modalPopup"
id="addFailed"
tabindex="-1"
role="dialog"
aria-labelledby="myModalLabel"
aria-hidden="true"
style="display: none;"
>
<p>You cannot add a new yard until the current yard status is either PO Cancelled or Escalation.</p>
<button type="button" class="btn btn-primary" id="okButton">
OK
</button>
</div>

<script>
$(document).ready(async function () {
// for auto-filling state,country
$("#zip").on("keyup", function() {
  console.log("sipp")
const zipCode = $(this).val();
if (zipCode.length === 5) {
if (zipCode) {
axios.get(`https://api.zippopotam.us/us/${zipCode}`)
.then(response => {
const data = response.data;
const city = data.places[0]['place name'];
const stateAbbr = data.places[0]['state abbreviation'];
const country = data['country abbreviation'];
console.log("country",country);
$("#city").val(city);
$("#state").val(stateAbbr);
$("#country").val(country); 
})
.catch(error => {
console.error("Error fetching location data:", error);
alert("Invalid ZIP code. Please check and try again.");
});
}}
});
// for us states
$('.state-select').select2({
placeholder: "Select State",
allowClear: true
});

const orderDetails = JSON.parse(localStorage.getItem('orderDetails'));
updateAddYardButton();
if (orderDetails) {
$("#orderNo").val(orderDetails.orderNo);
$("#customerName").val(orderDetails.customerName);
$("#email").val(orderDetails.email);
}

// Clear order details from localStorage after loading
localStorage.removeItem('orderDetails');
// Get the current time and the login timestamp
const currentTime = Date.now();
const loginTimestamp = localStorage.getItem("loginTimestamp");
if (loginTimestamp) {
const timeDifference =
(currentTime - loginTimestamp) / (1000 * 60 * 60);
if (timeDifference >= 12) {
alert(
"Your session has expired. You will be redirected to the login page."
);
window.localStorage.clear(); 
window.location.href = "login_signup.html";
}
} else {
window.location.href = "login_signup.html";
}
// when i am trying to do the following: i am getting an error because
const savedPaymentStatus = localStorage.getItem('paymentStatus');
console.log("paymentStatus",savedPaymentStatus);
if (savedPaymentStatus) {
$('.paymentStatus').val(savedPaymentStatus);
}
const firstName = localStorage.getItem("firstName");
const lastName = localStorage.getItem("lastName");
const token = localStorage.getItem("token");
const email = localStorage.getItem("email");
const role = localStorage.getItem("role");
const team = localStorage.getItem("team");
const urlParams = new URLSearchParams(window.location.search);
const isCancelled = urlParams.get('cancelled') === 'true';
const orderNo = urlParams.get("orderNo");
const process = urlParams.get("process");
const newEntry = urlParams.get("newEntry");
var yardIndex;
document.getElementById("orderHistory").textContent += orderNo;
document.getElementById("yardModalLabel").textContent += orderNo;
document.getElementById("editYardDetailsModalLabel").textContent += orderNo;


console.log("orderNo:", orderNo); 
console.log("process:", process);
console.log("newEntry:", newEntry);
console.log("team", team, token);

// part to check the paymentStatus
setTimeout(function() {
fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then(response => response.json())
.then(data => {
data.additionalInfo.forEach((yard, index) => {
const yardIndex = index + 1;
console.log("yardIndex", yardIndex, yard);

var pStatus = yard.paymentStatus;
console.log("pStatus", pStatus);

// Check if the payment status is "Card charged"
if (pStatus === "Card charged") {
$(`.yard-btn[data-yard-index="${yardIndex}"]`).css('background-color', '#353d3f');
}

// Check if the status is "Escalation"
console.log("=D=",yard.escTicked);
if (yard.escTicked === "Yes") {
$("#escTickBox").prop("checked", true);
}
});
})
.catch(error => console.error("Error fetching yard data:", error));
}, 500);


// part to check the apymentStatus ends

if (firstName) {
$("#user-name").text(firstName);
$("#salesAgent").val(firstName);
}

const isCancelledOrder = urlParams.get('cancelled') === 'true';
const cancelledOrderNo = urlParams.get("orderNo");

if (isCancelledOrder && cancelledOrderNo) {
console.log("cancelled orders")
fetch(`https://www.spotops360.com/cancelledOrders/${cancelledOrderNo}`, {
headers: { Authorization: `Bearer ${token}` }
})
.then((response) => response.json())
.then((data) => {
console.log("Fetched cancelled order data:", data);

// Populate the form fields with the cancelled order data
var customerNameE = data.customerName;
const nameParts = customerNameE.split(" ");
const firstNameE = nameParts[0];
const lastNameE = nameParts[1];
var notes = data.notes;
var notes1 = notes.toString();
var resultNotes = notes1.split('</br>')[0];
var onlyNotes = resultNotes.trim();
console.log("lastName",lastNameE);
$("#orderDate").val(data.orderDate);
$("#salesAgent").val(data.salesAgent);            
$("#bAddress").val(data.bAddress);
$("#firstName").val(firstNameE);
$("#lastname").val(lastNameE);
$("#sAddress").val(data.sAddress);
$("#email").val(data.email);
$("#phone").val(data.phone);
$("#make").val(data.make);
$("#model").val(data.model);
$("#year").val(data.year);
$("#pReq").val(data.pReq);
$("#desc").val(data.desc);
$("#warranty").val(data.warranty);
$("#soldP").val(data.soldP);
$("#costP").val(data.costP);
$("#shippingFee").val(data.shippingFee);
$("#salestax").val(data.salestax);
$("#grossProfit").val(data.grossProfit);
$("#orderStatus").val(data.orderStatus);
$("#vin").val(data.vin);
$("#issueOrder").val(data.last4digits);
$("#notes").val(`${onlyNotes}`);

// Disable all input fields since it's a cancelled order
$('input, select, textarea').prop('disabled', true);
$('#status').text('Order Status: Cancelled');

// Optionally add a "Cancelled" label or status message in the UI
// $('#cancelledOrderLabel').text(`Order No: ${cancelledOrderNo} is Cancelled`);

// If there are any additional info (e.g., yard details, tracking info)
data.additionalInfo.forEach((info, index) => {
addYardButton(index + 1, `Yard ${index + 1}`);
});

if (data.trackingInfo) {
$("#trackingInfoContainer").html(data.trackingInfo);
}

updateOrderHistory(data.orderHistory);

// Prevent any further form submission attempts
// $("#crmForm").on("submit", function (e) {
// e.preventDefault();
// alert('This order is cancelled. You cannot modify it.');
// });
})
.catch((error) => {
console.error("Error fetching cancelled order data:", error);
});

function fetchAndDisplaySaleNotes() {
fetch(`https://www.spotops360.com/cancelledOrders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
const notes = data.notes;
const saleNoteDiv = $("#saleNote");
const noteHtml = `<p>${notes}</p>`;
saleNoteDiv.append(noteHtml);
})
.catch((error) => {
console.error("Error fetching sale notes:", error);
});
}

fetchAndDisplaySaleNotes(orderNo);
}



let userRole = null;
let userEmail = null;

if (team === "Team Charlie") {
$("#submenu-reports .nav-link")
.not(':contains("My Sales Report")')
.hide();
$(
"#submenu-dashboards .view-orders-link, #submenu-dashboards .teamA-orders-link, #submenu-dashboards .teamB-orders-link, #submenu-dashboards .placed-orders-link, #submenu-dashboards .cancelled-orders-link, #submenu-dashboards .yard-info-link"
).hide();
$(".nav-item:has(#submenu-teams)").hide();
$(".nav-item:has(#submenu-users)").hide();
}
if (role === "Admin") {
$('#submenu-reports .nav-link:contains("My Sales Report")').hide();
$("#submenu-dashboards .view-individualOrders-link").hide();
}

if (role === "Admin" && team === "Team Charlie") {
$(".sidebarOrder").hide();
$(".add-yard-btn").hide();
}

$("#profileLink").click(function () {
$("#profileFirstName").val(firstName);
$("#profileLastName").val(lastName);
$("#profileEmail").val(email);
$("#profileRole").val(role);
$("#profileModal").modal("show");
});

$("#backToOrders").click(function () {
$("#profile-content").addClass("d-none");
$("#placed-order-content").removeClass("d-none");
});

$(".toggle-btn").on("click", function () {
$("#offcanvasSidebar").toggleClass("hide");
});

$(".close-btn").on("click", function () {
$("#offcanvasSidebar").toggleClass("hide");
});

$(".nav-link").on("click", function () {
$(".nav-link").removeClass("active selected");
$(this).addClass("selected");

const contentMap = {
"default-link": "#default-content",
"add-order-link": "#add-order-content",
"view-order-link": "#view-order-content",
};

$(".main-content > div").addClass("d-none");
$(contentMap[this.id]).removeClass("d-none");
$("#offcanvasSidebar").addClass("hide");
});

$(".nav-link").on("click", function () {
const submenu = $(this).next(".submenu");
if (submenu.length) {
submenu.slideToggle();
$(this)
.find(".chevron-icon i")
.toggleClass("fa-chevron-right fa-chevron-down");
} else {
$(".nav-link").removeClass("active");
$(this).addClass("active");

const contentMap = {
"default-link": "#default-content",
"add-order-link": "#add-order-content",
"view-order-link": "#view-order-content",
};

$(".main-content>div").addClass("d-none");
$(contentMap[this.id]).removeClass("d-none");
$("#offcanvasSidebar").addClass("hide");
}
});

$.ajax({
type: "GET",
url: "https://www.spotops360.com/teams",
success: function (teams) {
const teamCharlie = $("#team-charlie");
const teamMark = $("#team-mark");
const teamSussane = $("#team-sussane");

teams.forEach((team) => {
const teamHtml = `
${team.name}<br>
${team.team}<br>
${team.role}
`;
if (team.team === "Team Charlie") {
teamCharlie.append(teamHtml);
} else if (team.team === "Team Mark") {
teamMark.append(teamHtml);
} else if (team.team === "Team Sussane") {
teamSussane.append(teamHtml);
}
});
},
error: function (error) {
alert("Error fetching teams: " + error.responseJSON.message);
},
});

function calculateProfit() {
const quotedPrice = parseFloat($("#soldP").val()) || 0;
const yardPrice = parseFloat($("#costP").val()) || 0;
const shipping = parseFloat($("#shippingFee").val()) || 0;

const salesTax = 0.035 * quotedPrice;
const grossProfit = quotedPrice - yardPrice;
const netProfit = grossProfit - shipping - salesTax;

$("#salestax").val(salesTax.toFixed(2));
$("#grossProfit").val(netProfit.toFixed(2));
}

const today = new Date().toISOString().split("T")[0];
$("#orderDate").val(today);

$("#soldP, #costP, #shippingFee").on("input", calculateProfit);

function showModal(modalId) {
$(modalId).modal("show");
}

function addYardButton(yardIndex, buttonText) {
const buttonHtml = `
<button type="button" class="btn btn-info yard-btn" data-yard-index="${yardIndex}">${buttonText}</button>
<div class="yard-details" id="yard-details-${yardIndex}"></div>
`;
$("#yardInfoContainer").append(buttonHtml);
}
function showYardDetails(yardIndex) {
const yardDetails = $(`#yard-details-${yardIndex}`);
if (yardDetails.is(":visible")) {
yardDetails.hide();
} else {
console.log("orderNo0",orderNo);  
// First check in the main orders collection
fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
// If order is not found, a check in the cancelledOrders collection
if (!data || !data.additionalInfo) {
console.log('Order not found, checking in cancelled orders...');
return fetch(`https://www.spotops360.com/cancelledOrders/${orderNo}`);
} else {
return Promise.resolve({ status: 200, json: () => data });
}
})
.then((response) => {
if (response.status === 404) {
console.log("Order or cancelled order not found.");
return;
}
return response.json();
})
.then((data) => {
if (!data || !data.additionalInfo || !data.additionalInfo[yardIndex - 1]) {
return;
}
const yardData = data.additionalInfo[yardIndex - 1];

// Check payment status and apply color
if (yardData.paymentStatus === "Card charged") {
$(`.yard-btn[data-yard-index="${yardIndex}"]`).css('background-color', '#353d3f');
}

let yardDetailsHtml = `
<table class="table table-bordered">
<tr><td colspan="2">${formatYardData(yardData)}</td></tr>
<tr style="display:flex">
<td colspan="2">
<button type="button" class="edit-yard" data-yard-index="${yardIndex}">Edit Status</button>
<button type="button" class="edit-yard-details" data-yard-index="${yardIndex}">Edit Details</button>
<button type="button" class="cardcharged" data-yard-index="${yardIndex}">Card Charged</button>
<button type="button" class="refundCollect" data-yard-index="${yardIndex}">Refund Status</button>
</td>
</tr>
</table>
`;
yardDetails.html(yardDetailsHtml).show();
})
.catch((error) => {
console.error("Error fetching order data:", error);
});
}
}


function formatYardData(yardData) {
let yardInfo = `
<table style="width: 100%;">
<tr>
<td style="width: 50%; vertical-align: top;">
Yard Name: ${yardData.yardName}<br>
Address: ${yardData.address}<br>
Email: ${yardData.email}<br>
Phone No: ${yardData.phone}<br>
Agent Name: ${yardData.agentName}<br>
Part Price: $${yardData.partPrice}<br>
Shipping Method: ${yardData.shippingDetails}<br>
Others: $${yardData.others}<br>
</td>
<td style="width: 50%; vertical-align: top;">
${yardData.status ? `Status: ${yardData.status}<br>` : ""}
${yardData.paymentStatus ? `Payment Status: ${yardData.paymentStatus}<br>` : ""}
${yardData.paymentDetails ? `Payment Details: ${yardData.paymentDetails}<br>` : ""}
${yardData.trackingNo ? `Tracking No: ${yardData.trackingNo}<br>` : ""}
${yardData.shipperName ? `Carrier: ${yardData.shipperName}<br>` : ""}
${yardData.escalationDate ? `Escalation Date: ${yardData.escalationDate}<br>` : ""}
${yardData.escalationCause ? `Escalation Reason: ${yardData.escalationCause}<br>` : ""}
${yardData.escalationProcess ? `Escalation Process: ${yardData.escalationProcess}<br>` : ""}
${yardData.escReturnShipType ? `Shipping Type: ${yardData.escReturnShipType}<br>` : ""}
${yardData.escReturnShippingCharge ? `Shipping Charge: $${yardData.escReturnShippingCharge}<br>` : ""}
${yardData.escReplaceShipType ? `Shipping Type: ${yardData.escReplaceShipType}<br>` : ""}
${yardData.escReplaceShippingCharge ? `Shipping Charge: $${yardData.escReplaceShippingCharge}<br>` : ""}
${yardData.returnShipping ? `Return Shipping type: ${yardData.returnShipping}<br>` : ""}
${yardData.returnShippingCharge ? `Return shipping amount: $${yardData.returnShippingCharge}<br>` : ""}
${yardData.returnShippingCharge ? `Return shipping amount: $${yardData.returnShippingCharge}<br>` : ""}
${yardData.rmaStatus ? `RMA Status: ${yardData.rmaStatus}<br>` : ""}
${yardData.refundStatus ? `Refund Status: ${yardData.refundStatus}<br>` : ""}
${yardData.refundedAmount ? `Refunded Amount: $${yardData.refundedAmount}<br>` : ""}
</td>
</tr>
</table>
`;

return yardInfo;
}

function updateOrderHistory(orderHistory) {
const orderHistoryList = $("#orderHistoryList");
orderHistoryList.empty();
orderHistory.forEach((historyItem) => {
const [heading, ...details] = historyItem.split(" by ");
const listItem = `
<li class="timeline-item">
<div class="timeline-panel">
<div class="timeline-heading">${heading}</div>
<div class="timeline-body">
<p>${details.join(" by ")}</p>
</div>
</div>
</li>`;
orderHistoryList.append(listItem);
});
}
var vinNo = document.getElementById("vin").value;
console.log("vin");
if (orderNo) {

fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
document.getElementById("estPP").textContent += data.costP;
console.log("Fetched order data:", data);
var customerNameE = data.customerName;
console.log("cusName", customerNameE);
// updateOrderNotes(data);

const nameParts = customerNameE.split(" ");
const firstNameE = nameParts[0];
const lastNameE = nameParts[1];
var notes = data.notes;
var notes1 = notes.toString();
var resultNotes = notes1.split('</br>')[0];
var onlyNotes = resultNotes.trim();
console.log("saleNotes",onlyNotes);
console.log("First Name:", firstName);
console.log("Last Name:", lastName);
orderNo;
$("#orderDate").val(data.orderDate);
$("#salesAgent").val(data.salesAgent);
$("#bAddress").val(data.bAddress);
$("#firstName").val(firstNameE);
$("#lastname").val(lastNameE);
$("#sAddress").val(data.sAddress);
$("#email").val(data.email);
$("#phone").val(data.phone);
$("#make").val(data.make);
$("#model").val(data.model);
$("#year").val(data.year);
$("#pReq").val(data.pReq);
$("#desc").val(data.desc);
$("#warranty").val(data.warranty);
$("#soldP").val(data.soldP);
$("#costP").val(data.costP);
$("#shippingFee").val(data.shippingFee);
$("#salestax").val(data.salestax);
$("#grossProfit").val(data.grossProfit);
$("#orderStatus").val(data.orderStatus);
$("#vin").val(data.vin);
$("#issueOrder").val(data.last4digits);
$("#notes").val(`${onlyNotes}`);
data.additionalInfo.forEach((info, index) => {
addYardButton(index + 1, `Yard ${index + 1}`);
});

if (data.trackingInfo) {
$("#trackingInfoContainer").html(data.trackingInfo);
}

updateOrderHistory(data.orderHistory);

if (process) {
$("#crmForm input, #crmForm select").attr("disabled", true);
$("#orderStatus").attr("disabled", false);
}

if (process) {
$("#orderStatus").on("change", function () {
if ($(this).val() === "yardPoSent") {
showModal("#yardModal");
}
if ($(this).val() === "trackingInfoSent") {
showModal("#trackingModal");
}
});
}

// Listen for form submission
$("#crmForm").on("submit", function (e) {
e.preventDefault(); // Prevent the form from submitting normally

const firstName = localStorage.getItem("firstName");
var cusFName = document.getElementById("firstName").value;
var cuLName = document.getElementById("lastname").value;
var customerName = cusFName + " " + cuLName;

// Fetch the existing order details
fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())  // Parse the JSON response
.then((existingOrderData) => {
// Create the updatedData object, using the existing orderDate if the input is empty
const updatedData = {
orderNo: orderNo,
orderDate: $("#orderDate").val() || existingOrderData.orderDate, // Use existing orderDate if input is empty
salesAgent: $("#salesAgent").val(),
customerName: customerName,
bAddress: $("#bAddress").val(),
sAddress: $("#sAddress").val(),
email: $("#email").val(),
phone: $("#phone").val(),
make: $("#make").val(),
model: $("#model").val(),
year: $("#year").val(),
pReq: $("#pReq").val(),
desc: $("#desc").val(),
warranty: $("#warranty").val(),
soldP: $("#soldP").val(),
costP: $("#costP").val(),
shippingFee: $("#shippingFee").val(),
salestax: $("#salestax").val(),
grossProfit: $("#grossProfit").val(),
orderStatus: $("#orderStatus").val(),
vin: document.getElementById("vin").value,
last4digits: $("#issueOrder").val(),
notes: $("#notes").val(),
firstName: firstName,
};

// Now send the updated data to the API using the PUT method
return fetch(`https://www.spotops360.com/orders/${orderNo}?firstName=${firstName}`, {
method: "PUT",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(updatedData),  // Convert the data to JSON
});
})
.then((response) => {
if (!response.ok) {
throw new Error("Network response was not ok");
}
return response.json();
})
.then((data) => {
// If the update was successful, update the order history and redirect the user
updateOrderHistory(data.orderHistory);
const team = localStorage.getItem("team");
if (team === "Team Charlie") {
window.location.href = "individualOrders.html";
} else {
window.location.href = "orders.html";
}
})
.catch((error) => {
// Handle any errors
console.error("Error:", error);
});
});


partDesc = `
Year: ${data.year}
Make: ${data.make}
Model: ${data.model}
Part required: ${data.pReq}
Desc: ${data.desc}
VIN: ${data.vin}
Warranty: ${data.warranty}`;
});
}


else var newOrderNo;
if (newEntry) {
$('.navbar-nav').hide();
$('#offcanvasSidebar').show();
$(".sidebarOrder").hide();
$(".add-yard-btn").hide();
$(".new-div").hide();

$("#orderStatus").val("Placed");
$("#orderStatus").prop("disabled", true);
$("#mainContent").addClass("centered-form");

// Function to extract the highest order number from a collection
function getHighestOrderNo(orderArr, existingOrderNo) {
if (orderArr.length === 0) return existingOrderNo;

const lastElement = orderArr[orderArr.length - 1];
const lastOrderNo = lastElement.orderNo;

const numberPart = parseInt(lastOrderNo.slice(7), 10);
return numberPart;
}

axios
.all([
axios.get(`https://www.spotops360.com/orders`),
axios.get(`https://www.spotops360.com/cancelledOrders`),
])
.then(
axios.spread((orders, cancelledOrders) => {
// Get the highest existing order number from all collections
let existingOrderNo = "50STARS0000"; // Default if no orders exist
let orderNoArr = [];

orderNoArr.push(getHighestOrderNo(orders.data, existingOrderNo));
orderNoArr.push(getHighestOrderNo(cancelledOrders.data, existingOrderNo));

// Find the maximum order number
const highestOrderNo = Math.max(...orderNoArr);

// Increment to get the new order number
const incrementedNumber = highestOrderNo + 1;
const incrementedNumberStr = incrementedNumber.toString().padStart(4, "0");

newOrderNo = `50STARS${incrementedNumberStr}`;
console.log("newOrderNo", newOrderNo);
})
)
.catch((error) => {
console.error("Error fetching latest order:", error);
});
$("#crmForm").on("submit", function (e) {
e.preventDefault();
const firstName = localStorage.getItem("firstName");
var cusFName = document.getElementById("firstName").value;
var cusLName = document.getElementById("lastname").value;
console.log("name", cusFName, cusLName);
var customerName = cusFName + " " + cusLName;
var note = $("#notes").val()
var salesAgent = $("#salesAgent").val();
const now = new Date();
const options = {
timeZone: 'America/Chicago',
year: 'numeric',
month: '2-digit',
day: '2-digit',
hour: '2-digit',
minute: '2-digit',
second: '2-digit',
hour12: false,
};
const formatter = new Intl.DateTimeFormat('en-US', options);
const parts = formatter.formatToParts(now);
const formattedDate = `${parts[4].value}-${parts[0].value}-${parts[2].value} ${parts[6].value}:${parts[8].value}:${parts[10].value}`;
console.log('US Central Time:,mnbjklkjhbv', formattedDate);
var orderNote = ` ${note}</br>
${salesAgent},${formattedDate} :`
const newOrder = {
orderNo: newOrderNo,
orderDate: $("#orderDate").val(),
salesAgent: $("#salesAgent").val(),
customerName: customerName,
bAddress: $("#bAddress").val(),
sAddress: $("#sAddress").val(),
email: $("#email").val(),
phone: $("#phone").val(),
make: $("#make").val(),
model: $("#model").val(),
year: $("#year").val(),
pReq: $("#pReq").val(),
desc: $("#desc").val(),
warranty: $("#warranty").val(),
soldP: $("#soldP").val(),
costP: $("#costP").val(),
shippingFee: $("#shippingFee").val(),
salestax: $("#salestax").val(),
grossProfit: $("#grossProfit").val(),
orderStatus: $("#orderStatus").val(),
vin: $("#vin").val(),
last4digits: $("#issueOrder").val(),
notes: orderNote,
orderHistory: [
`Order placed by ${firstName} on ${formattedDate}`,
],
};

fetch("https://www.spotops360.com/orders", {
method: "POST",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(newOrder),
})
.then((response) => response.json())
.then((data) => {
const team = localStorage.getItem("team");
console.log("Team assigned:", team);
console.log("teamU", team);
alert(`Order No ${newOrderNo} has been placed.`);

if (team === "Team Charlie") {
window.location.href = "individualOrders.html";
} else {
window.location.href = "orders.html";
}
})
.catch((error) => {
console.error("Error:", error);
});
});
}
else {
$("#offcanvasSidebar").hide();
$("#navbar-nav").show();
$(".navbar-nav").css({
"flex-direction": "row",
"justify-content": "center",
"align-items": "center",
"margin-left": "62%",
});
$(".nav-item").addClass("mx-2");
$(".sidebar").hide();
$(".main-content").css("width", "70%");
$("#mainContent").removeClass("centered-form");

$(".navbar").css({
"background-color": "black",
color: "white",
});
$(".navbar .nav-link").css({
color: "white",
cursor: "pointer",
});

$(".navbar .user-info span").css({
color: "white",
});
$(".navbar .user-icon").css({
color: "white",
});

const sidebarLinks = $(".sidebar .nav-link").clone();
$(".navbar").append(sidebarLinks);

$(".nav-link").on("click", function () {
const submenu = $(this).next(".submenu");
if (submenu.length) {
submenu.slideToggle();
$(this)
.find(".chevron-icon i")
.toggleClass("fa-chevron-right fa-chevron-down");
}
});

// for sale note 
function fetchAndDisplaySaleNotes(orderNo) {
// First, check in the main orders collection
fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
// If the order is not found or doesn't contain notes, check in cancelledOrders
if (!data || !data.notes) {
console.log('Order not found, checking in cancelled orders...');
return fetch(`https://www.spotops360.com/cancelledOrders/${orderNo}`);
} else {
return Promise.resolve({ status: 200, json: () => data });
}
})
.then((response) => {
if (response.status === 404) {
console.log("Order or cancelled order not found.");
return;
}
return response.json();
})
.then((data) => {
if (!data || !data.notes) {
console.log("No sale notes found for this order.");
return;
}

// Display the sale notes
const notes = data.notes;
const saleNoteDiv = $("#saleNote");
const noteHtml = `<p>${notes}</p>`;
saleNoteDiv.append(noteHtml);
})
.catch((error) => {
console.error("Error fetching sale notes:", error);
});
}
// sale ntes till here

fetchAndDisplaySaleNotes(orderNo);
}

$("#orderStatus").on("change", function () {
// if ($(this).val() === "Yard PO sent") {
// showModal("#yardModal");
// $("#divTrackingEdit").hide();
// }
console.log("orderStatus",$(this).val());
if ($(this).val() === "Order Cancelled") {
  const id = $(this).data("id");
  
console.log(`Cancel for order ID: ${orderNo}`,id); 
fetch(`https://www.spotops360.com/orders/${orderNo}`, {
method: "DELETE",
headers: {
Authorization: `Bearer ${token}`
},
})
.then((response) => {
if (!response.ok) {
console.error("Failed to delete order", response);
throw new Error("Failed to delete order");
}
return response.json();
})
.then((data) => {
console.log("Order cancelled successfully", data); // Added log
window.location.reload();
})
.catch((error) => {
console.error("Error cancelling order:", error);
});

}
else {
$("#divTrackingEdit").hide();
$("#sendEmailButton").hide();
}
});

$("#yardInfoContainer").on("click", ".yard-btn", function () {
yardIndex = $(this).data("yard-index");
showYardDetails(yardIndex);
});


$(".add-yard-btn").on("click", function () {
console.log("add new yard")
// Fetch the order data first to get the order status and additionalInfo
fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
const orderStatus = data.orderStatus;
console.log("orderStatus",orderStatus);
const lastYardBtn = $("#yardInfoContainer .yard-btn").last();

if (orderStatus === "Placed") {
$('#yardModal').modal('hide'); // Hide modal
alert("You cannot add a new yard until the customer approves the order.");
} else if (lastYardBtn.length > 0) {
let yardIndex = lastYardBtn.data("yard-index");
const yardData = data.additionalInfo[yardIndex - 1];
console.log("yardData suggestions", yardData, orderStatus);

if (yardData.status === "PO cancelled" || yardData.status === "Escalation") {
showModal("#yardModal"); // Show modal if status is PO cancelled or Escalation
} else {
$('#yardModal').modal('hide'); // Hide modal
alert("You cannot add a new yard until the current yard status is either 'PO Cancelled' or 'Escalation'.");
}
} else {
// If there are no yards, allow adding the first yard
showModal("#yardModal"); // Show modal to add the first yard
}
})
.catch(error => console.error("Error fetching yard data:", error));
});







// card charged part starts here
let selectedYardIndex;
// On clicking the "Card Charged" button
// Function to fetch the payment status for the specific yard index from the database
function fetchPaymentStatus(orderNo, yardIndex) {
return fetch(`https://www.spotops360.com/orders/${orderNo}/additionalInfo/${yardIndex}`)
.then(response => response.json())
.then(data => data.paymentStatus)
.catch(error => console.error("Error fetching payment status:", error));
}
$('#yardInfoContainer').on('click', '.cardcharged', function () {
selectedYardIndex = $(this).data('yard-index');

fetchPaymentStatus(orderNo, selectedYardIndex).then(paymentStatus => {
if (paymentStatus) {
$('.paymentStatus').val(paymentStatus);
}
});

$("#cardCharged").fadeIn(); // Show the #cardCharged div with a fade-in effect
$(".mainDiv").addClass("blur");
});
//for refubd status
$('#yardInfoContainer').on('click', '.refundCollect', function () {
selectedYardIndex = $(this).data('yard-index');
console.log("refund collected part",selectedYardIndex);
$("#refundCollect").fadeIn(); 
$(".mainDiv").addClass("blur");
});




$("#closeCardCharged").on("click", function () {
$("#cardCharged").fadeOut(); // Hide the popup when the close button is clicked
$(".mainDiv").removeClass("blur");
});

$("#closeRefundCollected").on("click", function () {
$("#refundCollect").fadeOut(); // Hide the popup when the close button is clicked
$(".mainDiv").removeClass("blur");
});

// On clicking the submit button inside the popup
// Saving the selected payment status
$('#cardChargedSbmit').on('click', function() {
$('#cardCharged').hide();
$(".mainDiv").removeClass("blur");

const paymentStatus = $(".paymentStatus").val();
localStorage.setItem('paymentStatus', paymentStatus);
console.log('Payment status saved to localStorage:', localStorage.getItem('paymentStatus')); 

if (paymentStatus === "Card charged") {
$(`.yard-btn[data-yard-index="${selectedYardIndex}"]`).css('background-color', '#353d3f');
}

const data1 = { paymentStatus };

fetch(
`https://www.spotops360.com/orders/${orderNo}/additionalInfo/${selectedYardIndex}?firstName=${firstName}`,
{
method: "PUT",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(data1),
}
)
.then((response) => {
if (!response.ok) {
throw new Error("Network response was not ok");
}
return response.json();
})
.then((data) => {
updateOrderHistory(data.orderHistory);
showYardDetails(selectedYardIndex);
fetchAndUpdateYardInfo();
})
.catch((error) => {
console.error("Error:", error);
});
});
//  card charged part till here
// refundCollect part 
$('#refundSubmit').on('click', function() {
$('#refundCollect').hide();
$(".mainDiv").removeClass("blur");
console.log("refunf collect status", selectedYardIndex, "oNo", orderNo);

const refundStatus = $(".paymentStatusRefund")
.map(function () {
return $(this).val();
})
.get()
.filter(function (value) {
return value !== "";
})
.join();

const refundedAmount = $("#refundedAmount").val();
console.log("collect",refundStatus,refundedAmount);
// // Update button color based on payment status
// if (refundStatus === "Refund collected") {
//   $(`.yard-btn[data-yard-index="${selectedYardIndex}"]`).css('background-color', '#353d3f');
// }

const data1 = {
refundStatus: refundStatus,
refundedAmount:refundedAmount
};

fetch(
`https://www.spotops360.com/orders/${orderNo}/additionalInfo/${selectedYardIndex}?firstName=${firstName}`,
{
method: "PUT",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(data1),
}
)
.then((response) => {
if (!response.ok) {
throw new Error("Network response was not ok");
}
return response.json();
})
.then((data) => {
updateOrderHistory(data.orderHistory);
showYardDetails(selectedYardIndex);
fetchAndUpdateYardInfo();
})
.catch((error) => {
console.error("Error:", error);
});
});
// refundCollect part ends here

$("#yardInfoContainer").on("click", ".edit-yard", function () {
// Show the edit popup and add blur effect
$("#editYardPopup").show();
$(".mainDiv").addClass("blur");

yardIndex = $(this).data("yard-index");
$("#editYardInfo").data("yard-index", yardIndex);
$("#yardIndexEdit").val(yardIndex);
$("#submit").data("yard-index", yardIndex);

// Fetch order data from API
fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
if (!data.additionalInfo || !data.additionalInfo[yardIndex - 1]) {
return;
}

const yardData = data.additionalInfo[yardIndex - 1];

// Prefill input fields
$("#refund").val(yardData.status);
$("#cardCharged").val(yardData.paymentStatus);
$("#paymentStatusSelect").val(yardData.paymentStatus);
$("#refundedAmount").val(yardData.refundedAmount);
$("#esc").val(yardData.escalationCause);
$("#escProcess").val(yardData.escalationProcess);

// Handle escalation checkbox
if (yardData.status === "Escalation") {
$("#escTickBox").prop("checked", true);
$("#escalation").show();
} else {
$("#escTickBox").prop("checked", false);
$("#escalation").hide();
}

// Show the tracking section and prefill tracking information
if (yardData.status === "Part shipped") {
$("#divTrackingEdit").show();

// Prefill tracking information fields from yardData
$("#trackingNoEdit").val(yardData.trackingNo || "");
$("#etaEdit").val(yardData.eta || "");
$("#linkInput").val(yardData.trackingLink || "");

const predefinedShippers = ["UPS", "World Wide Express", "FedEx"];
if (predefinedShippers.includes(yardData.shipperName)) {
// If the shipper is one of the predefined ones, set the select value
$("#shipperNameEdit").val(yardData.shipperName);
$("#otherShipperInput").hide();
} else {
// If the shipper is not in the predefined list, set "Others" and show the input
$("#shipperNameEdit").val("Others");
$("#otherShipperInput").val(yardData.shipperName).show();
}
} else {
// Hide the tracking section if not "Part shipped"
$("#divTrackingEdit").hide();
}

// Show the modal
$("#editYardModal").modal("show");

// Fetch and display notes (if needed)
fetchAndDisplayNotes(yardIndex);
})
.catch((error) => {
console.error("Error fetching yard data:", error);
});
});

// Handle shipper selection to show or hide "Other" input
$("#shipperNameEdit").on("change", function () {
if ($(this).val() === "Others") {
$("#otherShipperInput").show();
} else {
$("#otherShipperInput").hide();
}
});



$("#editYardInfo").on("click", async function () {
console.log("clicking on save");
$(".mainDiv").removeClass("blur");
$("#editYardPopup").hide();

const yardIndex = $(this).data("yard-index");

// Fetch the current yard data from the server
let currentYardData = {};
try {
const response = await fetch(`https://www.spotops360.com/orders/${orderNo}`);
if (!response.ok) {
throw new Error("Failed to fetch current yard data");
}
const orderData = await response.json();
if (orderData.additionalInfo && orderData.additionalInfo[yardIndex - 1]) {
currentYardData = orderData.additionalInfo[yardIndex - 1];
}
} catch (error) {
console.error("Error fetching current yard data:", error);
return;
}

const status = $("#refund").val();
const returnCharges = $(".returnShipment").val();
const trackingNo = $("#trackingNoEdit").val();
const eta = $("#etaEdit").val();
console.log("eta", eta);
let shipperName = $("#shipperNameEdit").val();
if (shipperName === "Others") {
shipperName = $("#otherShipperInput").val();
}
const trackingLink = $("#linkInput").val();
const returnShippingMethod = $("input[name='returnValue']:checked").val();
const paymentStatus = $('.paymentStatus').val();
let escCause = '';
let escProcess = '';
let escReplacementShippingType = '';
let escReplacementShipCharge = '';
let escReturnShippingType = '';
let escReturnShipCharge = '';
let refundedAmount = $("#refundedAmount").val();
let rmaStatusValue = $('input[name="rma-status"]:checked').val();
console.log("Selected RMA Status:", rmaStatusValue);

// Variables to hold escalation-related data
let escDate;
let forEscDate;
let escTicked;

if (status === "Escalation") {
// Update the escalation-related fields only if status is "Escalation"
escCause = $("#esc").val();
escProcess = $("#escProcess").val();
escReplacementShippingType = $("#replacement-customer").val();
escReplacementShipCharge = $("#replacement-shipping-charges").val();
escReturnShippingType = $("#customer").val();
escReturnShipCharge = $("#shipping-charges").val();

escTicked = "Yes";
const now = new Date();
const options = {
timeZone: 'America/Chicago',
year: 'numeric',
month: '2-digit',
day: '2-digit',
hour: '2-digit',
minute: '2-digit',
second: '2-digit',
hour12: false,
};
const formatter = new Intl.DateTimeFormat('en-US', options);
const parts = formatter.formatToParts(now);
escDate = `${parts[4].value}-${parts[0].value}-${parts[2].value} ${parts[6].value}:${parts[8].value}:${parts[10].value}`;
const date = new Date(escDate);

const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
const day = date.getDate();
const month = months[date.getMonth()];
const year = date.getFullYear();
const daySuffix = (day) => {
if (day > 3 && day < 21) return "th";
switch (day % 10) {
case 1: return "st";
case 2: return "nd";
case 3: return "rd";
default: return "th";
}
};
forEscDate = `${day}${daySuffix(day)} ${month}, ${year}`;
}

// Construct the updated data object
const updatedData = {
...currentYardData,
status: status,
trackingNo: trackingNo || currentYardData.trackingNo,
eta: eta,
shipperName: shipperName,
trackingLink: trackingLink,
refundedAmount: refundedAmount ? parseFloat(refundedAmount) : currentYardData.refundedAmount,
returnShipping: returnShippingMethod,
returnShippingCharge: returnCharges,
};

// Add escalation fields only if status is "Escalation"
if (status === "Escalation") {
updatedData.escalationCause = escCause;
updatedData.escalationDate = forEscDate || "";
updatedData.escalationProcess = escProcess;
updatedData.escTicked = escTicked;
updatedData.escReturnShipType = escReturnShippingType;
updatedData.escReturnShippingCharge = escReturnShipCharge;
updatedData.escReplaceShipType = escReplacementShippingType;
updatedData.escReplaceShippingCharge = escReplacementShipCharge;
}

console.log("Yard Index:", yardIndex);
console.log("Order No:", orderNo);
console.log("Sending data:", JSON.stringify(updatedData));

// Send the updated data to the server
fetch(`https://www.spotops360.com/orders/${orderNo}/additionalInfo/${yardIndex}?firstName=${firstName}`, {
method: "PUT",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(updatedData),
})
.then((response) => {
if (!response.ok) {
throw new Error("Network response was not ok");
}
return response.json();
})
.then((data) => {
console.log("Server response:", data);

$("#editYardModal").modal("hide");
updateOrderHistory(data.orderHistory);
showYardDetails(yardIndex);
fetchAndUpdateYardInfo();

// Trigger the refund change manually after saving yard data
$("#refund").trigger("change");
})
.catch((error) => {
console.error("Error:", error);
});

window.location.reload();
});




async function fetchAndDisplayNotes(yardIndex) {
console.log("yIndex", yardIndex, "oNo", orderNo);
console.log("Fetching and displaying notes...");

fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
// console.log("notes",data,yardIndex);
console.log(
"Fetched notes:",
data.additionalInfo[yardIndex-1].notes
);
displayComments(data.additionalInfo[yardIndex-1].notes);
})
.catch((error) => {
console.error("Error fetching notes:", error);
});
}

async function fetchAndUpdateYardInfo() {
const token =
"d7efef519360bf1ae968db97c52855fcdfbfab171af45c4720f8b648cf2814f3069a696b70ad12bba620b5394ee11b076f4fc31bd07baee18ace4fb4c8bfed34"; // Use your provided token here
await fetchYardInfo(token);
}

var shippingMethod;
$("#addYardInfo").on("click", function (event) {
const firstName = localStorage.getItem("firstName");   
event.preventDefault();

const requiredFields = [
$("#yardName"),
$("#agentName"),
$("#yardRating"),
$("#phoneYard"),
$("#address"),
$("#city"),
$("#state"),
$("#zip"),
$("#partPrice")
];
console.log("re fields",requiredFields);
console.log("Selected state:", $("#state").val(),$("#phoneYard").val());
// Check if all required fields are filled
let allFieldsFilled = true;
requiredFields.forEach(function (field) {
console.log("Field element:", field);
console.log("Field value:", field.val()); // Log the value of each field
if (field.val().trim() === "") {
allFieldsFilled = false;
field.css("border-color", "red");
} else {
field.css("border-color", "");
}
});

console.log("reuired",allFieldsFilled);
// If not all fields are filled, show an alert and do not proceed
if (!allFieldsFilled) {
alert("Please fill out all required fields.");
return;
}

// Set the new order status and update it on the server
const newOrderStatus = "Yard Processing";
console.log("new order status", newOrderStatus);
$("#orderStatus").val(newOrderStatus);

const updatedData = { orderStatus: newOrderStatus };

fetch(`https://www.spotops360.com/orders/${orderNo}?firstName=${firstName}`, {
method: "PUT",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(updatedData),
})
.then((response) => {
if (!response.ok) {
throw new Error("Network response was not ok");
}
return response.json();
})
.then((data) => {
updateOrderHistory(data.orderHistory);
console.log("Order status updated successfully:", data);
})
.catch((error) => {
console.error("Error updating order status:", error);
});

// Proceed with form submission if all fields are filled
$(".mainDiv").removeClass("blur");
$("#yardModal").hide();
$("#refund").val("Yard located").change();

// Your existing code to submit the form data
const yardName = $("#yardName").val();
const agentName = $("#agentName").val();
const yardRating = $("#yardRating").val();
const phone = $("#phone").val();
const altPhone = $("#altPhone").val();
const email = $("#email").val();
const address = $("#address").val();
const city = $("#city").val();
const state = $("#state").val();
const country = $("#country").val();
const zipcode = $("#zip").val();
const addedAddress = address + "  " + city + "  " + state + "  " + zipcode;
const partPrice = $("#partPrice").val();
const ownShip = $("#ownShipping").val();
const yardShip = $("#yardShipping").val();
const others = document.getElementById("others").value;
const stockNo = $("#stockNo").val();
const warrYard = $("#warr").val();
console.lo("yard warr",warrYard);
const faxNo = $('#faxNo').val();
const ext = $('#ext').val();


let shippingMethod = "";
if (ownShip) {
shippingMethod = `Own shipping: ${ownShip} `;
} else if (yardShip) {
shippingMethod = `Yard shipping: ${yardShip}`;
}


const data222 = {
yardName: yardName,
agentName: agentName,
yardRating: yardRating,
phone: phone,
altPhone: altPhone,
ext: ext,
email: email,
street:address,
city:city,
state:state,
zipcode:zipcode,
address: addedAddress,
country: country,
partPrice: partPrice,
status: "Yard located",
shippingDetails: shippingMethod,
others: others,
faxNo: faxNo,
warranty: warrYard
};

fetch(`https://www.spotops360.com/orders/${orderNo}/additionalInfo?firstname=${firstName}`, {
method: "POST",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(data222),
})
.then((response) => {
if (!response.ok) {
throw new Error("Network response was not ok");
}
return response.json();
})
.then((data) => {
$("#editYardPopup").hide();
addYardButton(
data.additionalInfo.length,
`Yard ${data.additionalInfo.length}`
);
updateOrderHistory(data.orderHistory);
fetchAndUpdateYardInfo();
})
.catch((error) => {
console.error("Error:", error);
});

window.location.reload();
});





async function fetchYardInfo(token) {
const response = await axios.get("https://www.spotops360.com/yardInfo", {
headers: { Authorization: `Bearer ${token}` },
});

if (response.status !== 200) {
throw new Error("Failed to fetch yard information");
}

const data = response.data;

let maxYards = 0;
data.forEach((item) => {
if (item.additionalInfo.length > maxYards) {
maxYards = item.additionalInfo.length;
}
});

const tableHeader = $("#tableHeader");
for (let i = 1; i <= maxYards; i++) {
tableHeader.append(`<th scope="col">Yard ${i}</th>`);
}

const yardInfoTable = $("#yardInfoTable");
yardInfoTable.empty();
data.forEach((item) => {
let yardInfoHtml = "";
for (let i = 0; i < maxYards; i++) {
const yardClass =
item.additionalInfo[i]?.paymentStatus === "Card charged"
? "highlight-red"
: "";
yardInfoHtml += `<td class="${yardClass}">${
item.additionalInfo[i]?.yardName || ""
}: ${item.additionalInfo[i]?.status || ""}</td>`;
}

yardInfoTable.append(
`<tr>
<td>${item.orderNo}</td>
<td>${item.customerName}</td>
${yardInfoHtml}
</tr>`
);
});
}

$("input[name='shippingMethod']").on("change", function () {
if ($(this).val() === "Own shipping") {
$("#ownShippingInput").show();
$("#yardShippingInput").hide();
} else if ($(this).val() === "yard_shipping") {
$("#yardShippingInput").show();
$("#ownShippingInput").hide();
}
});
$("input[name='returnValue']").on("change", function () {
console.log("our/cust clicked");
if ($(this).val() === "Our shipping") {
$("#ourShippingInput").show();
$("#customerShippingInput").hide();
} else if ($(this).val() === "Customer shipping") {
$("#customerShippingInput").show();
$("#ourShippingInput").hide();
}
});

$("#escProcess").on("change", function () {
var escpMethod = $("#escProcess").val();
console.log("method", escpMethod);
if (escpMethod === "Return tracking sent") {
$("#shipping_own_cust").show();
}
});

$("#refund").on("change", function () {
const refundStatus = $(this).val();
const orderStatus = $("#orderStatus").val();

let newOrderStatus = orderStatus;

// Capture the selected shipping method before hiding any elements
var selectedShipping = $("input[name='returnValue']:checked").val() || "";
console.log("selectedShipping",selectedShipping);
let shippingPrice = 0;

if (selectedShipping === "Our shipping") {
shippingPrice = $("#ourShippingInput").val();
} else if (selectedShipping === "Customer shipping") {
shippingPrice = $("#customerShippingInput").val();
}else if(selectedShipping === "") {
selectedShipping = "";
shippingPrice = "";
}

if (refundStatus === "Part shipped") {
newOrderStatus = "In Transit";
$("#divTrackingEdit").show();
$("#sendEmailButton").show();
$("#notesContainer").show();
$("#cardCharged").hide();
$("#escalation").hide();
} else if (refundStatus === "PO confirmed") {
$("#escalation").hide();
$("#divTrackingEdit").hide();
$("#sendEmailButton").hide();
$("#notesContainer").show();
$("#cardCharged").hide();
} else if (refundStatus === "Escalation") {
$("#escalation").show();
$("#divTrackingEdit").hide();
$("#sendEmailButton").hide();
$("#notesContainer").show();
$("#cardCharged").hide();
} else if (refundStatus === "PO cancelled") {
$("#divTrackingEdit").hide();
$("#sendEmailButton").hide();
$("#notesContainer").show();
$("#cardCharged").hide();
} else if (refundStatus === "Part delivered") {
newOrderStatus = "Order Fulfilled";
$("#notesContainer").show();
$("#divTrackingEdit").hide();
$("#cardCharged").hide();
} else if (refundStatus === "Yard PO Sent") {
newOrderStatus = "Yard Processing";
$("#escalation").hide();
$("#divTrackingEdit").hide();
} else if (refundStatus === "Yard located") {
$("#divTrackingEdit").hide();
} else {
$("#divTrackingEdit").hide();
$("#sendEmailButton").hide();
$("#notesContainer").hide();
}

// Updating the order status with shipping information
const updatedData = {
orderStatus: newOrderStatus,
shippingMethod: selectedShipping,
shippingPrice: shippingPrice
};
console.log("updatedData",updatedData);

fetch(`https://www.spotops360.com/orders/${orderNo}?firstName=${firstName}`, {
method: "PUT",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(updatedData),
})
.then((response) => {
if (!response.ok) {
throw new Error("Network response was not ok");
}
return response.json();
})
.then((data) => {
$("#orderStatus").val(newOrderStatus);
updateOrderHistory(data.orderHistory);
})
.catch((error) => {
console.error("Error updating order status:", error);
});
});


$(".paymentStatus").on("change", function () {
const paymentStatus = $(this).val();
if (
paymentStatus === "Card charged" ||
paymentStatus === "Refund collected"
) {
$("#paymentOptions").show();
} else {
$("#paymentOptions").hide();
}
});

$("#paymentYesNo").on("change", function () {
const paymentYesNo = $(this).val();
const paymentStatus = $(".paymentStatus").val();
if (paymentYesNo === "Yes") {
if (paymentStatus === "Card charged") {
$("#payment").val("Card charged");
} else if (paymentStatus === "Refund collected") {
$("#payment").val("Refund collected");
}
} else {
$("#payment").val("");
}
});
$("#shipperNameEdit").on("change", function () {
const selectedValue = $(this).val();

if (selectedValue === "Others") {
// Show the input field for "Others"
$("#otherShipperInput").show();
} else {
// Hide the input field for "Others" when another option is selected
$("#otherShipperInput").hide();
}
});
$("#sendEmailButton").on("click", function () {
const trackingNo = $("#trackingNoEdit").val();
const eta = $("#etaEdit").val();
var shipperName = $("#shipperNameEdit").val();
if (shipperName === "Others") {
shipperName = $("#otherShipperInput").val();
}
const link = $("#linkInput").val();
if (trackingNo && eta && shipperName && link) {
const data = {
trackingNo: trackingNo,
eta: eta,
shipperName: shipperName,
link: link,
};

fetch(`https://www.spotops360.com/orders/sendTrackingInfo/${orderNo}`, {
method: "POST",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(data),
})
.then((response) => response.json())
.then((result) => {
alert("Tracking details sent to the customer");
console.log("Success:", result);
})
.catch((error) => {
console.error("Error:", error);
});
} else {
alert("Please fill in all the tracking information fields.");
}
});

$("#yardInfoContainer").on("click", ".edit-yard-details", function () {
console.log("edit yard details")
$(".mainDiv").addClass("blur");
yardIndex = $(this).data("yard-index");
fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
if (!data.additionalInfo || !data.additionalInfo[yardIndex - 1]) {
return;
}
const yardData = data.additionalInfo[yardIndex - 1];
console.log("yardData",yardData);
$("#editYardName").val(yardData.yardName);
$("#editAddress").val(yardData.street);
$("#editYardRating").val(yardData.yardRating);
const addressParts = yardData.address.split(" ");
$("#editCity").val(yardData.city);
$("#editState").val(yardData.state);
$("#editZip").val(yardData.zipcode);
$("#editPhone").val(yardData.phone);
$("#editAltPhone").val(yardData.altPhone);
$("#editEmail").val(yardData.email);
$("#editAgentName").val(yardData.agentName);
$("#editCountry").val(yardData.country);
$("#editPartPrice").val(yardData.partPrice);
$("#editOthers").val(yardData.others);
$("#editPaymentStatus").val(yardData.paymentStatus);
$("#editrefundAmount").val(yardData.refundedAmount);
$("#editFax").val(yardData.faxNo);
$('#editWarr').val(yardData.warranty)

const shippingDetails = yardData.shippingDetails;
console.log("shippingDetails:", shippingDetails);
if (shippingDetails.includes("Own shipping")) {
const ownShippingValue = shippingDetails.split(":")[1].trim(); 
console.log("own ship", ownShippingValue);
$("#editOwnShipping").val(ownShippingValue);
$("#editYardShipping").val('');  
} else if (shippingDetails.includes("Yard shipping")) {
const yardShippingValue = shippingDetails.split(":")[1].trim();
console.log("yard ship", yardShippingValue);
$("#editYardShipping").val(yardShippingValue);
$("#editOwnShipping").val('');  
}


// Set other fields as needed
$("#refund").val(yardData.status);
$("#paymentStatusSelect").val(yardData.paymentStatus);

if (yardData.paymentStatus === "Refund collected") {
$("#refundedAmountContainer").show();
$("#refundedAmount").val(yardData.refundedAmount);
} else {
$("#refundedAmountContainer").hide();
}

$("#esc").val(yardData.escalationCause);
$("#escProcess").val(yardData.escalationProcess);

if (yardData.status === "Escalation") {
$("#escalation").show();
} else {
$("#escalation").hide();
}

$("#editYardDetailsModal").modal("show");
$("#saveYardDetails").data("yard-index", yardIndex);
});

});


$("#saveYardDetails").on("click", function () {
$('#editYardDetailsModal').hide();
$(".mainDiv").removeClass("blur");
yardIndex = $(this).data("yard-index");

let shippingDetails = "";

if ($("#editOwnShipping").val()) {
shippingDetails = `Own shipping: ${$("#editOwnShipping").val()}`;
console.log("oSHip",shippingDetails);
} else if ($("#editYardShipping").val()) {
shippingDetails = `Yard shipping: ${$("#editYardShipping").val()}`;
console.log("ySHip",shippingDetails);
}

const updatedData = {
yardName: $("#editYardName").val(),
agentName: $("#editAgentName").val(),
yardRating: $("#editYardRating").val(),
phone: $("#editPhone").val(),
editAlt: $("#editAltPhone").val(),
address: $("#editAddress").val(),
email: $("#editEmail").val(),
country: $("#editCountry").val(),
city:$("#editCity").val(),
state:$("#editState").val(),
street:$("#editAddress").val(),
partPrice: $("#editPartPrice").val(),
others: $("#editOthers").val(),
warranty: $("#editWarr").val(),
faxNo: $("#editFax").val(),
shippingDetails: shippingDetails,
status: $("#refund").val(),
paymentStatus: $("#editPaymentStatus").val(),
refundedAmount: $("#editrefundAmount").val(),
escalationCause: $("#esc").val(),
escalationProcess: $("#escProcess").val(),
};

fetch(
`https://www.spotops360.com/orders/${orderNo}/additionalInfo/${yardIndex}?firstName=${firstName}`,
{
method: "PUT",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify(updatedData),
}
)
.then((response) => {
alert("Yard details have been updated");
$("#editYardDetailsModal").modal("hide");
$(".mainDiv").removeClass("blur");
if (!response.ok) {
throw new Error("Network response was not ok");
}
return response.json();
})
.then((data) => {
$("#editYardDetailsModal").modal("hide");

updateOrderHistory(data.orderHistory);
showYardDetails(yardIndex);
fetchAndUpdateYardInfo();
})
.catch((error) => {
console.error("Error:", error);
});
window.location.reload();
});


$("input[name='editShippingMethod']").on("change", function () {
if ($(this).val() === "Own shipping") {
$("#editOwnShippingInput").show();
$("#editYardShippingInput").hide();
} else {
$("#editYardShippingInput").show();
$("#editOwnShippingInput").hide();
}
});
$("#paymentStatusSelect").on("change", function () {
if ($(this).val() === "Refund collected") {
$("#refundedAmountContainer").show();
} else {
$("#refundedAmountContainer").hide();
}
});


// for yard Comments
const field = document.querySelector("textarea");
const backUp = field.getAttribute("placeholder");
const btn = document.querySelector(".btn");
const clear = document.getElementById("clear");
const submit = document.querySelector("#submit");
const comments = document.getElementById("comment-box");
// const orderNo = new URLSearchParams(window.location.search).get(
//   "orderNo"
// );

$("#submit").on("click", function (event) {
event.preventDefault();
const content = $("#noteInput").val();
const yardIndex = $("#submit").data("yard-index") - 1;
const firstName = localStorage.getItem("firstName");
// const timestamp = new Date().toLocaleString();
const now = new Date();
const options = {
timeZone: 'America/Chicago',
year: 'numeric',
month: '2-digit',
day: '2-digit',
hour: '2-digit',
minute: '2-digit',
second: '2-digit',
hour12: false,
};
const formatter = new Intl.DateTimeFormat('en-US', options);
const parts = formatter.formatToParts(now);
const formattedDate = `${parts[4].value}-${parts[0].value}-${parts[2].value} ${parts[6].value}:${parts[8].value}:${parts[10].value}`;

const date = new Date(formattedDate);

// Array of month names
const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
const day = date.getDate();
const month = months[date.getMonth()];
const year = date.getFullYear();
const hour = date.getHours();
const minute = date.getMinutes().toString().padStart(2, '0');

const daySuffix = (day) => {
if (day > 3 && day < 21) return "th"; // All days between 4th and 20th get 'th'
switch (day % 10) {
case 1: return "st";
case 2: return "nd";
case 3: return "rd";
default: return "th";
}
};

var yardNteDate= `${day}${daySuffix(day)} ${month}, ${year} ${hour}:${minute}`;

if (content.length > 0) {
axios
.post(
`https://www.spotops360.com/orders/${orderNo}/notes/${yardIndex}`,
{
note: content,
author: firstName,
timestamp: yardNteDate,
}
)
.then((response) => {
$("#noteInput").val("");
console.log("yindex",yardIndex);
fetchAndDisplayNotes(yardIndex + 1);
})
.catch((error) => {
console.error("Error:", error);
alert(`Failed to update notes: ${error.message}`);
});
}
});
function displayComments(notes) {
const commentBox = $("#comment-box");
commentBox.empty();

if (Array.isArray(notes)) {
console.log("notes", notes);
notes.forEach((note) => {
const noteHtml = `<p>${note}</p>`;
console.log("htmlNote", noteHtml);
commentBox.append(noteHtml);
console.log("comment", commentBox);
});
} else {
console.error("Expected notes to be an array, but got:", notes);
}
}
// yard comments till here
$("#editYardPopup").on("show.bs.modal", function () {
const yardIndex = $("#yardIndexEdit").val();
console.log("dyIndex",yardIndex);
fetchAndDisplayNotes(yardIndex - 1);
});


// const comments_arr = [];

// const display_comments = () => {
//   let list = "<ul>";
//   comments_arr.forEach((comment) => {
//     list += `<li>${comment}</li>`;
//   });
//   list += "</ul>";
//   comments.innerHTML = list;
// };



$("#closeBtnEditYard, .close").on("click", function () {
$("#editYardPopup").hide();
});

// support comment atsrts here
const commentSupport = document.getElementById("comment-boxSupport");
$("#submitComments").on("click", function (event) {
window.location.reload();
event.preventDefault();
const content1 = $("#commentInput").val();
const yardIndex1 = $("#submit").data("yard-index") - 1;
const firstName1 = localStorage.getItem("firstName");
const timestamp1 = new Date().toLocaleString();
const now = new Date();
const options = {
timeZone: 'America/Chicago',
year: 'numeric',
month: '2-digit',
day: '2-digit',
hour: '2-digit',
minute: '2-digit',
second: '2-digit',
hour12: false,
};
const formatter = new Intl.DateTimeFormat('en-US', options);
const parts = formatter.formatToParts(now);
const formattedDate = `${parts[4].value}-${parts[0].value}-${parts[2].value} ${parts[6].value}:${parts[8].value}:${parts[10].value}`;

const date = new Date(formattedDate);

// Array of month names
const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
const day = date.getDate();
const month = months[date.getMonth()];
const year = date.getFullYear();
const hour = date.getHours();
const minute = date.getMinutes().toString().padStart(2, '0');

const daySuffix = (day) => {
if (day > 3 && day < 21) return "th"; // All days between 4th and 20th get 'th'
switch (day % 10) {
case 1: return "st";
case 2: return "nd";
case 3: return "rd";
default: return "th";
}
};

var commentNteDate= `${day}${daySuffix(day)} ${month}, ${year} ${hour}:${minute}`;
if (content1.length > 0) {
axios
.put(
`https://www.spotops360.com/orders/${orderNo}/supportNotes`,
{
note: content1,
author: firstName1,
timestamp: commentNteDate,
}
)
.then((response) => {
alert("Support comments updated successfully.");
$("#commentInput").val("");
fetchSupportComment(yardIndex1);
})
.catch((error) => {
console.error("Error:", error);
alert(`Failed to update notes: ${error.message}`);
});
}
});

async function fetchSupportComment() {
console.log("Fetching and displaying support comments...");

fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
console.log("Fetched notes:", data.supportNotes);
displaySnotes(data.supportNotes);
})
.catch((error) => {
console.error("Error fetching notes:", error);
});
}

function displaySnotes(notes) {
const commentBox1 = $("#comment-boxSupport");
commentBox1.empty();

if (Array.isArray(notes)) {
console.log("support notes", notes);
notes.forEach((note) => {
const noteHtml = `<p>${note}</p>`;
commentBox1.append(`<h2 style="text-align: center;font-weight: 600;"></h2>`);
commentBox1.append(noteHtml);
});
} else {
console.error("Expected notes to be an array, but got:", notes);
}
}


fetchSupportComment();
//support comments till here

$('.toggle-btn').on('click', function () {
$('.sidebar').toggleClass('hide');
});
$('.close-btn').on('click', function () {
$('.sidebar').addClass('hide');
});

$(".chevron-icon, .nav-link").on("click", function (event) {
event.stopPropagation();
const submenu = $(this).closest(".nav-item").find(".submenu");
submenu.toggle();
$(this).find("i").toggleClass("fa-chevron-right fa-chevron-down");
$(this).closest(".nav-link").toggleClass("selected");
});


const currentPath = window.location.pathname;
$(".nav-link").each(function () {
if (currentPath.includes($(this).attr("href"))) {
$(this).addClass("active");
}
});
$('#crossBtnEditYard').on('click', function(e) {
$('#editYardPopup').hide();
$(".mainDiv").removeClass("blur");
});
$('#EYdetails') .on('click', function(e){
// $(".mainDiv").removeClass("blur");
$('#editYardDetailsModal').hide();
window.location.reload();
})     

$("#logoutLink").click(function () {
window.localStorage.clear();
window.location.href = "login_signup.html";
});


// for descBar start hre
fetchOrderDetails(orderNo)
.then((order) => {
const year = order.year;
const make = order.make;
const model = order.model;
const description = order.desc;
const partRequired = order.pReq;

// Format the part description
const partDescriptionText = `Part Required: ${partRequired} - For ${year} ${make} ${model} - Desc: ${description}`;

// Insert the part description into the appropriate div
$(".partDescFY.descBar").text(partDescriptionText);
})
.catch((error) => {
console.error("Error fetching order details:", error);
});
// Function to fetch order details
function fetchOrderDetails(orderNo) {
return fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
return data;

});
}
//show deopdown on navbar
// Show dropdown on hover
$(".navbar .nav-item").hover(function () {
$(this).find(".dropdown-menu").stop(true, true).delay(100).fadeIn(200);
}, function () {
$(this).find(".dropdown-menu").stop(true, true).delay(100).fadeOut(200);
});

// Toggle dropdown on click
$(".nav-item .nav-link").on("click", function (event) {
event.preventDefault(); // Prevent the default behavior
const submenu = $(this).next(".dropdown-menu");
if (submenu.length) {
submenu.stop(true, true).slideToggle(200);
}
});

// Also toggle on chevron icon click
$(".chevron-icon").on("click", function (event) {
event.preventDefault
event.stopPropagation();
const submenu = $(this).closest(".nav-item").find(".dropdown-menu");
submenu.stop(true, true).slideToggle(200);
});
// function to add yards only when status is PO cancelled or Escalation
function updateAddYardButton() {
let canAddNewYard = true;
$("#yardInfoContainer .yard-btn").each(function () {
let yardIndex = $(this).data("yard-index");

fetch(`https://www.spotops360.com/orders/${orderNo}`)
.then((response) => response.json())
.then((data) => {
const yardData = data.additionalInfo[yardIndex - 1];
if (yardData.status !== "PO Cancelled" && yardData.status !== "Escalation") {
canAddNewYard = false;
}

// Disable the button if conditions are not met
if (!canAddNewYard) {
$(".add-yard-btn").prop('disabled', true);
} else {
$(".add-yard-btn").prop('disabled', false);
}
});
});
}
$("#okButton").click(function () {
window.location.reload();
});
// script for escalationReturn
document.getElementById("escProcess").addEventListener("change", function() {
var selectedValue = this.value;
var escalationReturnDiv = document.querySelector(".escalationReturn");
var escalationReplacementDiv = document.querySelector(".escalationReplacement");
console.log("escalationreturn",escalationReturnDiv);
if (selectedValue === "Return") {
escalationReturnDiv.style.display = "flex";
escalationReplacementDiv.style.display = "none";
}
else if (selectedValue === "Replacement") {
escalationReplacementDiv.style.display = "flex";
escalationReturnDiv.style.display = "none";
}
else {
escalationReturnDiv.style.display = "none";
escalationReplacementDiv.style.display = "none";
}
});
//for showing shipping charges
//for showing shipping charges
document.getElementById("customer").addEventListener("change", function() {
var selectedValue = this.value;
// For the escalationReturn div
const shippingChargesContainer = document.getElementById('shipping-charges-container');
if (selectedValue === 'Return- Own shipping') {
shippingChargesContainer.style.display = 'block';
} else {
shippingChargesContainer.style.display = 'none';
}
});

document.getElementById("replacement-customer").addEventListener("change", function() {
var selectedValue = this.value;
const replacementShippingChargesContainer = document.getElementById('replacement-shipping-charges-container');
console.log("escReplace",replacementShippingChargesContainer);
if (selectedValue === 'Replacement- Own shipping') {
replacementShippingChargesContainer.style.display = 'block';
} else {
replacementShippingChargesContainer.style.display = 'none';
}

});

document.getElementById("rma-status-group").addEventListener("change", function(event) {
const checkboxes = document.querySelectorAll('#rma-status-group input[type="checkbox"]');
const selectedCheckbox = event.target;

// Uncheck all checkboxes except the one that was just clicked
checkboxes.forEach(checkbox => {
if (checkbox !== selectedCheckbox) {
checkbox.checked = false;
}
});

// Get the value of the selected checkbox
const selectedValue = selectedCheckbox.checked ? selectedCheckbox.value : null;
console.log("Selected RMA Status:", selectedValue);
});


});
</script>
</body>   
</html>